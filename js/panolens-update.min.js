!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("three")):"function"==typeof define&&define.amd?define(["exports","three"],e):e((t=t||self).PANOLENS={},t.THREE)}(this,function(t,e){function i(t){this.constraints=Object.assign({video:{width:{ideal:1920},height:{ideal:1080},facingMode:{exact:"environment"}},audio:!1},t),this.element=this.scene=this.container=null,this.devices=[],this.stream=null,this.ratioScalar=1,this.videoDeviceIndex=0}function n(t){this.format=null,this.eyeSep=void 0===t?.064:t,this.loffset=new e.Vector2,this.roffset=new e.Vector2}function o(t,i,n){t=void 0===t?16777215:t,i=void 0===i||i,n=void 0===n?1500:n,this.dpr=window.devicePixelRatio;var o=this.createCanvas(),s=o.canvas;o=o.context;var a=new e.SpriteMaterial({color:t,map:this.createCanvasTexture(s)});e.Sprite.call(this,a),this.canvasWidth=s.width,this.canvasHeight=s.height,this.context=o,this.color=t instanceof e.Color?t:new e.Color(t),this.autoSelect=i,this.dwellTime=n,this.rippleDuration=500,this.position.z=-10,this.center.set(.5,.5),this.scale.set(.5,.5,1),this.callback=this.timerId=this.startTimestamp=null,this.frustumCulled=!1,this.updateCanvasArcByProgress(0)}function s(t,i,n){t=void 0===t?300:t,i=i||R.Info,e.Sprite.call(this),this.type="infospot",this.animated=void 0===n||n,this.frustumCulled=this.isHovering=!1,this.cursorStyle=this.toPanorama=this.element=null,this.mode=L.NORMAL,this.scale.set(t,t,1),this.rotation.y=Math.PI,this.container=null,this.originalRaycast=this.raycast,this.HANDLER_FOCUS=null,this.material.side=e.DoubleSide,this.material.depthTest=!1,this.material.transparent=!0,this.material.opacity=0,this.scaleUpAnimation=new k.Tween,this.scaleDownAnimation=new k.Tween,n=function(i){if(this.material){var n=i.image.width/i.image.height,o=new e.Vector3;i.image.width=i.image.naturalWidth||64,i.image.height=i.image.naturalHeight||64,this.scale.set(n*t,t,1),o.copy(this.scale),this.scaleUpAnimation=new k.Tween(this.scale).to({x:1.3*o.x,y:1.3*o.y},500).easing(k.Easing.Elastic.Out),this.scaleDownAnimation=new k.Tween(this.scale).to({x:o.x,y:o.y},500).easing(k.Easing.Elastic.Out),this.material.map=i,this.material.needsUpdate=!0}}.bind(this),this.showAnimation=new k.Tween(this.material).to({opacity:1},500).onStart(this.enableRaycast.bind(this,!0)).easing(k.Easing.Quartic.Out),this.hideAnimation=new k.Tween(this.material).to({opacity:0},500).onStart(this.enableRaycast.bind(this,!1)).easing(k.Easing.Quartic.Out),this.addEventListener("click",this.onClick),this.addEventListener("hover",this.onHover),this.addEventListener("hoverenter",this.onHoverStart),this.addEventListener("hoverleave",this.onHoverEnd),this.addEventListener("panolens-dual-eye-effect",this.onDualEyeEffect),this.addEventListener("panolens-container",this.setContainer.bind(this)),this.addEventListener("dismiss",this.onDismiss),this.addEventListener("panolens-infospot-focus",this.setFocusMethod),x.load(i,n)}function a(t){t||console.warn("PANOLENS.Widget: No container specified"),e.EventDispatcher.call(this),this.DEFAULT_TRANSITION="all 0.27s ease",this.TOUCH_ENABLED=!!("ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch),this.PREVENT_EVENT_HANDLER=function(t){t.preventDefault(),t.stopPropagation()},this.container=t,this.mask=this.activeSubMenu=this.activeMainItem=this.mainMenu=this.settingElement=this.videoElement=this.fullscreenElement=this.barElement=null}function r(){this.edgeLength=1e4,e.Mesh.call(this,this.createGeometry(this.edgeLength),this.createMaterial()),this.type="panorama",this.ImageQualityLow=1,this.ImageQualityFair=2,this.ImageQualityMedium=3,this.ImageQualityHigh=4,this.ImageQualitySuperHigh=5,this.animationDuration=1e3,this.defaultInfospotSize=350,this.container=void 0,this.loaded=!1,this.linkedSpots=[],this.isInfospotVisible=!1,this.linkingImageScale=this.linkingImageURL=void 0,this.renderOrder=-1,this.active=!1,this.infospotAnimation=new k.Tween(this).to({},this.animationDuration/2),this.addEventListener("load",this.fadeIn.bind(this)),this.addEventListener("panolens-container",this.setContainer.bind(this)),this.addEventListener("click",this.onClick.bind(this)),this.setupTransitions()}function h(t){r.call(this),this.src=t,this.type="image_panorama"}function c(){r.call(this),this.type="empty_panorama"}function l(t){t=void 0===t?[]:t,r.call(this),this.images=t,this.type="cube_panorama"}function d(){for(var t=[],e=0;6>e;e++)t.push(R.WhiteTile);l.call(this,t),this.type="basic_panorama"}function u(t,e){e=void 0===e?{}:e,r.call(this),this.src=t,this.options=Object.assign({videoElement:document.createElement("video"),loop:!0,muted:!0,autoplay:!1,playsinline:!0,crossOrigin:"anonymous"},e),this.videoElement=this.options.videoElement,this.videoProgress=0,this.type="video_panorama",this.addEventListener("leave",this.pauseVideo.bind(this)),this.addEventListener("enter-fade-start",this.resumeVideoProgress.bind(this)),this.addEventListener("video-toggle",this.toggleVideo.bind(this)),this.addEventListener("video-time",this.setVideoCurrentTime.bind(this))}function p(t){var e;this._parameters=t=void 0===t?{}:t,this._panoId=this._zoom=null,this._panoClient=new google.maps.StreetViewService,this._total=this._count=0,this._canvas=[],this._ctx=[],this._hc=this._wc=0,this.result=null,this.rotation=0,this.copyright="",this.onPanoramaLoad=this.onSizeChange=null,this.levelsW=[1,2,4,7,13,26],this.levelsH=[1,1,2,4,7,13],this.widths=[416,832,1664,3328,6656,13312],this.heights=[416,416,832,1664,3328,6656],this.maxH=this.maxW=6656;try{var i=document.createElement("canvas");(e=i.getContext("experimental-webgl"))||(e=i.getContext("webgl"))}catch(t){}this.maxW=Math.max(e.getParameter(e.MAX_TEXTURE_SIZE),this.maxW),this.maxH=Math.max(e.getParameter(e.MAX_TEXTURE_SIZE),this.maxH)}function m(t,e){h.call(this),this.panoId=t,this.gsvLoader=null,this.loadRequested=!1,this.setupGoogleMapAPI(e),this.type="google_streetview_panorama"}function v(t,i){"image"===(void 0===t?"image":t)&&h.call(this,i),this.EPS=1e-6,this.frameId=null,this.dragging=!1,this.userMouse=new e.Vector2,this.quatA=new e.Quaternion,this.quatB=new e.Quaternion,this.quatCur=new e.Quaternion,this.quatSlerp=new e.Quaternion,this.vectorX=new e.Vector3(1,0,0),this.vectorY=new e.Vector3(0,1,0),this.type="little_planet",this.addEventListener("window-resize",this.onWindowResize)}function f(t){v.call(this,"image",t),this.type="image_little_planet"}function g(t){r.call(this),this.media=new i(t),this.type="camera_panorama",this.addEventListener("enter",this.start.bind(this)),this.addEventListener("leave",this.stop.bind(this)),this.addEventListener("panolens-container",this.onPanolensContainer.bind(this)),this.addEventListener("panolens-scene",this.onPanolensScene.bind(this))}function A(t,e){e=void 0===e?new n:e,h.call(this,t),this.stereo=e,this.type="stereo_image_panorama"}function y(t,e,i){e=void 0===e?{}:e,i=void 0===i?new n:i,u.call(this,t,e),this.stereo=i,this.type="stereo_video_panorama"}function E(t,i){function n(t){if(N=!1,U=B=0,!1!==g.enabled){if(t.preventDefault(),t.button===g.mouseButtons.ORBIT){if(!0===g.noRotate)return;z=_.ROTATE,A.set(t.clientX,t.clientY)}else if(t.button===g.mouseButtons.ZOOM){if(!0===g.noZoom)return;z=_.DOLLY,L.set(t.clientX,t.clientY)}else if(t.button===g.mouseButtons.PAN){if(!0===g.noPan)return;z=_.PAN,b.set(t.clientX,t.clientY)}z!==_.NONE&&(document.addEventListener("mousemove",o,!1),document.addEventListener("mouseup",s,!1),g.dispatchEvent(Z)),g.update()}}function o(t){if(!1!==g.enabled){t.preventDefault();var e=g.domElement===document?g.domElement.body:g.domElement;if(z===_.ROTATE){if(!0===g.noRotate)return;y.set(t.clientX,t.clientY),E.subVectors(y,A),g.rotateLeft(2*Math.PI*E.x/e.clientWidth*g.rotateSpeed),g.rotateUp(2*Math.PI*E.y/e.clientHeight*g.rotateSpeed),A.copy(y),u&&(U=t.clientX-u.clientX,B=t.clientY-u.clientY),u=t}else if(z===_.DOLLY){if(!0===g.noZoom)return;T.set(t.clientX,t.clientY),R.subVectors(T,L),0<R.y?g.dollyIn():0>R.y&&g.dollyOut(),L.copy(T)}else if(z===_.PAN){if(!0===g.noPan)return;w.set(t.clientX,t.clientY),M.subVectors(w,b),g.pan(M.x,M.y),b.copy(w)}z!==_.NONE&&g.update()}}function s(){N=!0,u=void 0,!1!==g.enabled&&(document.removeEventListener("mousemove",o,!1),document.removeEventListener("mouseup",s,!1),g.dispatchEvent(Q),z=_.NONE)}function a(t){if(!1!==g.enabled&&!0!==g.noZoom&&z===_.NONE){t.preventDefault(),t.stopPropagation();var e=0;void 0!==t.wheelDelta?e=t.wheelDelta:void 0!==t.detail&&(e=-t.detail),0<e?(g.object.fov=g.object.fov<g.maxFov?g.object.fov+1:g.maxFov,g.object.updateProjectionMatrix()):0>e&&(g.object.fov=g.object.fov>g.minFov?g.object.fov-1:g.minFov,g.object.updateProjectionMatrix()),g.update(),g.dispatchEvent(W),g.dispatchEvent(Z),g.dispatchEvent(Q)}}function r(t){switch(t.keyCode){case g.keys.UP:p=!1;break;case g.keys.BOTTOM:m=!1;break;case g.keys.LEFT:v=!1;break;case g.keys.RIGHT:f=!1}}function h(t){if(!1!==g.enabled&&!0!==g.noKeys&&!0!==g.noRotate){switch(t.keyCode){case g.keys.UP:p=!0;break;case g.keys.BOTTOM:m=!0;break;case g.keys.LEFT:v=!0;break;case g.keys.RIGHT:f=!0}(p||m||v||f)&&(N=!0,p&&(B=-g.rotateSpeed*g.momentumKeydownFactor),m&&(B=g.rotateSpeed*g.momentumKeydownFactor),v&&(U=-g.rotateSpeed*g.momentumKeydownFactor),f&&(U=g.rotateSpeed*g.momentumKeydownFactor))}}function c(t){if(N=!1,U=B=0,!1!==g.enabled){switch(t.touches.length){case 1:if(!0===g.noRotate)return;z=_.TOUCH_ROTATE,A.set(t.touches[0].pageX,t.touches[0].pageY);break;case 2:if(!0===g.noZoom)return;z=_.TOUCH_DOLLY;var e=t.touches[0].pageX-t.touches[1].pageX;t=t.touches[0].pageY-t.touches[1].pageY,L.set(0,Math.sqrt(e*e+t*t));break;case 3:if(!0===g.noPan)return;z=_.TOUCH_PAN,b.set(t.touches[0].pageX,t.touches[0].pageY);break;default:z=_.NONE}z!==_.NONE&&g.dispatchEvent(Z)}}function l(t){if(!1!==g.enabled){t.preventDefault(),t.stopPropagation();var e=g.domElement===document?g.domElement.body:g.domElement;switch(t.touches.length){case 1:if(!0===g.noRotate)break;if(z!==_.TOUCH_ROTATE)break;y.set(t.touches[0].pageX,t.touches[0].pageY),E.subVectors(y,A),g.rotateLeft(2*Math.PI*E.x/e.clientWidth*g.rotateSpeed),g.rotateUp(2*Math.PI*E.y/e.clientHeight*g.rotateSpeed),A.copy(y),u&&(U=t.touches[0].pageX-u.pageX,B=t.touches[0].pageY-u.pageY),u={pageX:t.touches[0].pageX,pageY:t.touches[0].pageY},g.update();break;case 2:if(!0===g.noZoom)break;if(z!==_.TOUCH_DOLLY)break;e=t.touches[0].pageX-t.touches[1].pageX,t=t.touches[0].pageY-t.touches[1].pageY,T.set(0,Math.sqrt(e*e+t*t)),R.subVectors(T,L),0>R.y?(g.object.fov=g.object.fov<g.maxFov?g.object.fov+1:g.maxFov,g.object.updateProjectionMatrix()):0<R.y&&(g.object.fov=g.object.fov>g.minFov?g.object.fov-1:g.minFov,g.object.updateProjectionMatrix()),L.copy(T),g.update(),g.dispatchEvent(W);break;case 3:if(!0===g.noPan)break;if(z!==_.TOUCH_PAN)break;w.set(t.touches[0].pageX,t.touches[0].pageY),M.subVectors(w,b),g.pan(M.x,M.y),b.copy(w),g.update();break;default:z=_.NONE}}}function d(){N=!0,u=void 0,!1!==g.enabled&&(g.dispatchEvent(Q),z=_.NONE)}this.object=t,this.domElement=void 0!==i?i:document,this.frameId=null,this.enabled=!0,this.center=this.target=new e.Vector3,this.noZoom=!1,this.zoomSpeed=1,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.noRotate=!1,this.rotateSpeed=-.15,this.noPan=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.momentumDampingFactor=.9,this.momentumScalingFactor=-.005,this.momentumKeydownFactor=20,this.minFov=30,this.maxFov=120,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.noKeys=!1,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={ORBIT:e.MOUSE.LEFT,ZOOM:e.MOUSE.MIDDLE,PAN:e.MOUSE.RIGHT};var u,p,m,v,f,g=this,A=new e.Vector2,y=new e.Vector2,E=new e.Vector2,b=new e.Vector2,w=new e.Vector2,M=new e.Vector2,C=new e.Vector3,I=new e.Vector3,L=new e.Vector2,T=new e.Vector2,R=new e.Vector2,S=0,x=0,O=0,D=0,k=1,j=new e.Vector3,P=new e.Vector3,V=new e.Quaternion,U=0,B=0,N=!1,_={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},z=_.NONE;this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom;var F=(new e.Quaternion).setFromUnitVectors(t.up,new e.Vector3(0,1,0)),H=F.clone().inverse(),W={type:"change"},Z={type:"start"},Q={type:"end"};this.setLastQuaternion=function(t){V.copy(t),g.object.quaternion.copy(t)},this.getLastPosition=function(){return P},this.rotateLeft=function(t){void 0===t&&(t=2*Math.PI/60/60*g.autoRotateSpeed),D-=t},this.rotateUp=function(t){void 0===t&&(t=2*Math.PI/60/60*g.autoRotateSpeed),O-=t},this.panLeft=function(t){var e=this.object.matrix.elements;C.set(e[0],e[1],e[2]),C.multiplyScalar(-t),j.add(C)},this.panUp=function(t){var e=this.object.matrix.elements;C.set(e[4],e[5],e[6]),C.multiplyScalar(t),j.add(C)},this.pan=function(t,i){var n=g.domElement===document?g.domElement.body:g.domElement;if(g.object instanceof e.PerspectiveCamera){var o=g.object.position.clone().sub(g.target).length();o*=Math.tan(g.object.fov/2*Math.PI/180),g.panLeft(2*t*o/n.clientHeight),g.panUp(2*i*o/n.clientHeight)}else g.object instanceof e.OrthographicCamera?(g.panLeft(t*(g.object.right-g.object.left)/n.clientWidth),g.panUp(i*(g.object.top-g.object.bottom)/n.clientHeight)):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.")},this.momentum=function(){N&&(1e-4>Math.abs(U)&&1e-4>Math.abs(B)?N=!1:(B*=this.momentumDampingFactor,U*=this.momentumDampingFactor,D-=this.momentumScalingFactor*U,O-=this.momentumScalingFactor*B))},this.dollyIn=function(t){void 0===t&&(t=Math.pow(.95,g.zoomSpeed)),g.object instanceof e.PerspectiveCamera?k/=t:g.object instanceof e.OrthographicCamera?(g.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom*t)),g.object.updateProjectionMatrix(),g.dispatchEvent(W)):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.")},this.dollyOut=function(t){void 0===t&&(t=Math.pow(.95,g.zoomSpeed)),g.object instanceof e.PerspectiveCamera?k*=t:g.object instanceof e.OrthographicCamera?(g.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/t)),g.object.updateProjectionMatrix(),g.dispatchEvent(W)):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.")},this.update=function(t){var e=this.object.position;I.copy(e).sub(this.target),I.applyQuaternion(F),S=Math.atan2(I.x,I.z),x=Math.atan2(Math.sqrt(I.x*I.x+I.z*I.z),I.y),this.autoRotate&&z===_.NONE&&this.rotateLeft(2*Math.PI/60/60*g.autoRotateSpeed),this.momentum(),S+=D,x+=O,S=Math.max(this.minAzimuthAngle,Math.min(this.maxAzimuthAngle,S)),x=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,x)),x=Math.max(1e-7,Math.min(Math.PI-1e-7,x));var i=I.length()*k;i=Math.max(this.minDistance,Math.min(this.maxDistance,i)),this.target.add(j),I.x=i*Math.sin(x)*Math.sin(S),I.y=i*Math.cos(x),I.z=i*Math.sin(x)*Math.cos(S),I.applyQuaternion(H),e.copy(this.target).add(I),this.object.lookAt(this.target),O=D=0,k=1,j.set(0,0,0),(1e-7<P.distanceToSquared(this.object.position)||1e-7<8*(1-V.dot(this.object.quaternion)))&&(!0!==t&&this.dispatchEvent(W),P.copy(this.object.position),V.copy(this.object.quaternion))},this.reset=function(){z=_.NONE,this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(W),this.update()},this.getPolarAngle=function(){return x},this.getAzimuthalAngle=function(){return S},this.dispose=function(){this.domElement.removeEventListener("mousedown",n),this.domElement.removeEventListener("mousewheel",a),this.domElement.removeEventListener("DOMMouseScroll",a),this.domElement.removeEventListener("touchstart",c),this.domElement.removeEventListener("touchend",d),this.domElement.removeEventListener("touchmove",l),window.removeEventListener("keyup",r),window.removeEventListener("keydown",h)},this.domElement.addEventListener("mousedown",n,{passive:!1}),this.domElement.addEventListener("mousewheel",a,{passive:!1}),this.domElement.addEventListener("DOMMouseScroll",a,{passive:!1}),this.domElement.addEventListener("touchstart",c,{passive:!1}),this.domElement.addEventListener("touchend",d,{passive:!1}),this.domElement.addEventListener("touchmove",l,{passive:!1}),window.addEventListener("keyup",r,{passive:!1}),window.addEventListener("keydown",h,{passive:!1}),this.update()}function b(t,i){var n=this,o={type:"change"},s=0,a=0,r=0;this.camera=t,this.camera.rotation.reorder("YXZ"),this.domElement=void 0!==i?i:document,this.enabled=!0,this.deviceOrientation=null,this.alphaOffsetAngle=this.alpha=this.screenOrientation=0;var h=function(t){n.deviceOrientation=t},c=function(){n.screenOrientation=window.orientation||0},l=function(t){t.preventDefault(),t.stopPropagation(),a=t.touches[0].pageX,r=t.touches[0].pageY},d=function(t){t.preventDefault(),t.stopPropagation(),s+=e.Math.degToRad((r-t.touches[0].pageY)/4),n.rotateLeft(-e.Math.degToRad((t.touches[0].pageX-a)/4)),a=t.touches[0].pageX,r=t.touches[0].pageY};this.connect=function(){c(),window.addEventListener("orientationchange",c,{passive:!0}),window.addEventListener("deviceorientation",h,{passive:!0}),window.addEventListener("deviceorientation",this.update.bind(this),{passive:!0}),n.domElement.addEventListener("touchstart",l,{passive:!1}),n.domElement.addEventListener("touchmove",d,{passive:!1}),n.enabled=!0},this.disconnect=function(){window.removeEventListener("orientationchange",c,!1),window.removeEventListener("deviceorientation",h,!1),window.removeEventListener("deviceorientation",this.update.bind(this),!1),n.domElement.removeEventListener("touchstart",l,!1),n.domElement.removeEventListener("touchmove",d,!1),n.enabled=!1},this.update=function(t){if(!1!==n.enabled&&n.deviceOrientation){var i=n.deviceOrientation.alpha?e.Math.degToRad(n.deviceOrientation.alpha)+n.alphaOffsetAngle:0,a=n.deviceOrientation.beta?e.Math.degToRad(n.deviceOrientation.beta):0,r=n.deviceOrientation.gamma?e.Math.degToRad(n.deviceOrientation.gamma):0,h=n.screenOrientation?e.Math.degToRad(n.screenOrientation):0,c=n.camera.quaternion,l=new e.Vector3(0,0,1),d=new e.Euler,u=new e.Quaternion,p=new e.Quaternion(-Math.sqrt(.5),0,0,Math.sqrt(.5)),m=new e.Quaternion,v=new e.Quaternion;if(0==n.screenOrientation){var f=new e.Vector3(1,0,0);m.setFromAxisAngle(f,-s)}else 180==n.screenOrientation?(f=new e.Vector3(1,0,0),m.setFromAxisAngle(f,s)):90==n.screenOrientation?(f=new e.Vector3(0,1,0),m.setFromAxisAngle(f,s)):-90==n.screenOrientation&&(f=new e.Vector3(0,1,0),m.setFromAxisAngle(f,-s));p.multiply(m),p.multiply(v),d.set(a,i,-r,"YXZ"),c.setFromEuler(d),c.multiply(p),c.multiply(u.setFromAxisAngle(l,-h)),n.alpha=i,!0!==t&&n.dispatchEvent(o)}},this.updateAlphaOffsetAngle=function(t){this.alphaOffsetAngle=t},this.updateRotX=function(t){s=t},this.rotateLeft=function(t){this.updateAlphaOffsetAngle(this.alphaOffsetAngle-t)},this.rotateUp=function(t){this.updateRotX(s+t)},this.dispose=function(){this.disconnect()},this.connect()}function w(t){var i=new e.OrthographicCamera(-1,1,1,-1,0,1),n=new e.Scene,o=new e.StereoCamera;o.aspect=.5;var s=new e.WebGLRenderTarget(512,512,{minFilter:e.LinearFilter,magFilter:e.NearestFilter,format:e.RGBAFormat});s.scissorTest=!0,s.texture.generateMipmaps=!1;var a=new e.Vector2(.441,.156),r=new e.PlaneBufferGeometry(1,1,10,20).removeAttribute("normal").toNonIndexed(),h=r.attributes.position.array,c=r.attributes.uv.array;r.attributes.position.count*=2,r.attributes.uv.count*=2;var l=new Float32Array(2*h.length);l.set(h),l.set(h,h.length);var d=new Float32Array(2*c.length);d.set(c),d.set(c,c.length),c=new e.Vector2,h=h.length/3;for(var u=0,p=l.length/3;u<p;u++){c.x=l[3*u],c.y=l[3*u+1];var m=c.dot(c);m=1.5+(a.x+a.y*m)*m;var v=u<h?0:1;l[3*u]=c.x/m*1.5-.5+v,l[3*u+1]=c.y/m*3,d[2*u]=.5*(d[2*u]+v)}r.attributes.position.array=l,r.attributes.uv.array=d,a=new e.MeshBasicMaterial({map:s.texture}),r=new e.Mesh(r,a),n.add(r),this.setEyeSeparation=function(t){o.eyeSep=t},this.setSize=function(e,i){t.setSize(e,i);var n=t.getPixelRatio();s.setSize(e*n,i*n)},this.render=function(e,a,r){var h=r instanceof A||r instanceof y;e.updateMatrixWorld(),h&&this.setEyeSeparation(r.stereo.eyeSep),null===a.parent&&a.updateMatrixWorld(),o.update(a),a=s.width/2;var c=s.height;t.autoClear&&t.clear(),h&&r.updateTextureToLeft(),s.scissor.set(0,0,a,c),s.viewport.set(0,0,a,c),t.setRenderTarget(s),t.render(e,o.cameraL),t.clearDepth(),h&&r.updateTextureToRight(),s.scissor.set(a,0,a,c),s.viewport.set(a,0,a,c),t.setRenderTarget(s),t.render(e,o.cameraR),t.clearDepth(),t.setRenderTarget(null),t.render(n,i)}}function M(t){t=void 0===t?{}:t;var i=this.options=Object.assign({container:this.setupContainer(t.container),controlBar:!0,controlButtons:["fullscreen","setting","video"],autoHideControlBar:!1,autoHideInfospot:!0,horizontalView:!1,clickTolerance:10,cameraFov:60,reverseDragging:!1,enableReticle:!1,dwellTime:1500,autoReticleSelect:!0,viewIndicator:!1,indicatorSize:30,output:null,autoRotate:!1,autoRotateSpeed:2,autoRotateActivationDuration:5e3,initialLookAt:new e.Vector3(0,0,-Number.MAX_SAFE_INTEGER)},t);t=i.container;var n=i.cameraFov,o=i.controlBar,s=i.controlButtons,a=i.viewIndicator,r=i.indicatorSize,h=i.enableReticle,c=i.reverseDragging,l=i.output,d=i.scene,u=i.camera;i=i.renderer;var p=t.clientWidth,m=t.clientHeight;this.container=t,this.scene=this.setupScene(d),this.sceneReticle=new e.Scene,this.camera=this.setupCamera(n,p/m,u),this.renderer=this.setupRenderer(i,t),this.reticle=this.addReticle(this.camera,this.sceneReticle),this.control=this.setupControls(this.camera,t),this.effect=this.setupEffects(this.renderer,t),this.mode=L.NORMAL,this.pressObject=this.pressEntityObject=this.infospot=this.hoverObject=this.widget=this.panorama=null,this.raycaster=new e.Raycaster,this.raycasterPoint=new e.Vector2,this.userMouse=new e.Vector2,this.updateCallbacks=[],this.requestAnimationId=null,this.cameraFrustum=new e.Frustum,this.cameraViewProjectionMatrix=new e.Matrix4,this.outputDivElement=this.autoRotateRequestId=null,this.touchSupported="ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch,this.tweenLeftAnimation=new k.Tween,this.tweenUpAnimation=new k.Tween,this.outputEnabled=!1,this.viewIndicatorSize=r,this.tempEnableReticle=h,this.handlerMouseUp=this.onMouseUp.bind(this),this.handlerMouseDown=this.onMouseDown.bind(this),this.handlerMouseMove=this.onMouseMove.bind(this),this.handlerWindowResize=this.onWindowResize.bind(this),this.handlerKeyDown=this.onKeyDown.bind(this),this.handlerKeyUp=this.onKeyUp.bind(this),this.handlerTap=this.onTap.bind(this,{clientX:p/2,clientY:m/2}),o&&this.addDefaultControlBar(s),a&&this.addViewIndicator(),c&&this.reverseDraggingDirection(),h?this.enableReticleControl():this.registerMouseAndTouchEvents(),"overlay"===l&&this.addOutputElement(),this.registerEventListeners(),this.animate.call(this)}var C="^0.105.2".replace(/[^0-9.]/g,""),I={ORBIT:0,DEVICEORIENTATION:1},L={UNKNOWN:0,NORMAL:1,CARDBOARD:2,STEREO:3},T={TAB:0,SBS:1},R={Info:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAABmJLR0QAAAAAAAD5Q7t/AAAACXBIWXMAAABIAAAASABGyWs+AAAACXZwQWcAAABAAAAAQADq8/hgAAADBklEQVR42u2bP08UQRiHnzFaSYCI/xoksdBIqGwIiYWRUBISExpCQ0ej38FWOmlIKKhoMPEbaCxsrrHiYrQgOSlQEaICrT+LHSPZzNzt3s3c3Hn7lHvLzvv82L2dm30XKioqKgYY062BJF0HpoA7wARwBbhsPz4DjoEG8AnYNcZ8Sx1Op8IXJM1KWpdUV3nq9m9nJV1I7VNGfEzSM0mNNqR9NOwxx1L7NRMflbQm6SSgeJ4TO8Zoat+8/LKkg4jieQ4kLaf2RtKwpJ0uiufZkTScSn5S0l5C+b/sSZrstvyMpKPU5uc4kjTTjkvpeYCkaeA1/+7hvcIZMGuMqUULQNIU8Aa4ltrWwyHwyBizGzwASSPAe+B2assW7AH3jTE/i+xcZoa12Qfy2Bo3i+5cKABl99zF1GYlWFTBeULLS0DZrOsDcDNggTXgc27bLWA64BhfgHvGmB8dHUXZ1DM0S45xliKMs9bKr+klIOkqsBrwv9JtVq1DewEAT4Ch1BYdMGQdygeg7Df4SmqDAKyoyXpCszPgITCeuvoAjFuX0gE8jljUdv7bCtiOOJ7XpdUZ8L/gdXHOA5QtYH5NXXVgbrgWWn1nwFTqaiPgdPIFcDd1tRFwOl307DwRuZgXwLvctgfA04hjOp18AcReZ6sZY16e3yDpUuQxnU6+S2AkcjEpcDr1zxOXSPgCKLSa0mc4nXwB/EpdbQScTr4AGqmrjYDTyRfAx9TVRsDp5Aug8LJyH+F0cgZg58z11BUHpO5ruGh2G3ybuuqAeF2aBfAqddUB8bq0OgP2U1cegH3aOQOMMb+BrdTVB2DLupQLwLIOnKY26IBT6+ClaQDGmO/ARmqLDtiwDn7HVkcY+EdjNoTlCI+tYhO2iUppm6HKslPUq2qQKHpUe8AFsjaUXuUQWCgqXyoAG8IuME/WkNRrnAHzZfqDSgdgQ6gBc2Td3b3CMTBXtkOsIzTIjZLnQhjcVtlcEIPZLJ0LoVvt8s/Va+3yuSAG84UJRxB98cpM9dJURUVFxSDzBxKde4Lk3/h2AAAAAElFTkSuQmCC",Arrow:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAABmJLR0QAAAAAAAD5Q7t/AAAACXBIWXMAAABIAAAASABGyWs+AAAACXZwQWcAAABAAAAAQADq8/hgAAADPklEQVR42u2bMUscQRiG30/SRaJEI1ZKUiRErNIELRUbQYSAnX8hpVUgkDYp0wgWVjYW+QcJaQzYpLojJIXhtDDEKBpj65ti58ixmdmb2ZvZ7+T2AUHudmfmeXf2bnb3O6CmpqZmgJGqOiI5AWAWwEMA0wDuArht3r4CcAagBeAbgIaI/NQOp1fhIZKLJN+SbDKcptl3keSQtk+I+BjJVyRbJaRdtEybY9p+ReKjJN+QvIwonufS9DGq7ZuXXyd5nFA8zzHJdW1vkLxDcrdC8Ty7JO9oyc+QPFCUb3NAcqZq+TmSp9rmHZySnCvjErwOIPkUwHv8+w7vF64ALIrIfrIASM4C+ADgnratgxMACyLSiB4AyREAnwE80LbswgGAJyJy4bNxyApr6wbIw4xxy3djrwCYfeeuaZsFsEbPdULXU4DZqusLgMkEA21P05EEbf8A8FhEzos28pkBLxLKL5s/r/M1kEkz9vKQHGeatf05yfmOfubNa7G5JDle5NhtBjwHMBz5yFwAWBaRT+0XzP8pZsKwcQiH2fX8Ycojb+kzxUw4ZJn7CSQXqpRPHMKCq7+iZJ71Mvdy/DftXSQ6HcJdSDaqPPKW/mPOBO+lcbvzCU35RCFM2PpwnQKzZQfdgfe0dxH5dLA6uQJ4pC2fIASrkyuA6X6QjxyC1ckVQNn7bNHlI4ZgdXIFUObiJJl8pBCsTjGfuIwA2Cv4FN7xbYjkjqsRAHuIePXoCiDF1Zk2VidXAL+1R5sAq5MrgJb2aBNgdXIF8FV7tAmwOrkCCFs73wysTtYATHFCU3vEEWm6Ci6KvgY/ao86Ik6XogDeaY86Ik6XbjPgSHvkEThCwQy45XpDRK5JbgN4GWkgUyR9H65MRQxgW0SunZ5FezK7pfwd8e8MV8UfAPdF5Jdrg8JrAbPjprZFD2wWyQP6j8ZSEufRmGlgQ9umBBvd5IOgbjFUKLu+XnWBhG+rpsFVZGUo/coJgFVf+aAATAgNACvICpL6jSsAKyH1QcEBmBD2ASwhq+7uF84ALIVWiPUEB7lQsiOEwS2VzQUxmMXSuRCqKpd/zX4rl88FMZg/mLAEcSN+MlP/aKqmpqZmkPkL0hSjwOpNKxwAAAAASUVORK5CYII=",FullscreenEnter:"data:image/svg+xml;base64,PHN2ZyBmaWxsPSIjRkZGRkZGIiBoZWlnaHQ9IjI0IiB2aWV3Qm94PSIwIDAgMjQgMjQiIHdpZHRoPSIyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICAgIDxwYXRoIGQ9Ik0wIDBoMjR2MjRIMHoiIGZpbGw9Im5vbmUiLz4KICAgIDxwYXRoIGQ9Ik03IDE0SDV2NWg1di0ySDd2LTN6bS0yLTRoMlY3aDNWNUg1djV6bTEyIDdoLTN2Mmg1di01aC0ydjN6TTE0IDV2MmgzdjNoMlY1aC01eiIvPgo8L3N2Zz4=",FullscreenLeave:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz48IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCI+PHBhdGggc3R5bGU9ImZpbGw6I2ZmZiIgZD0iTTE0LDE0SDE5VjE2SDE2VjE5SDE0VjE0TTUsMTRIMTBWMTlIOFYxNkg1VjE0TTgsNUgxMFYxMEg1VjhIOFY1TTE5LDhWMTBIMTRWNUgxNlY4SDE5WiIgLz48L3N2Zz4=",VideoPlay:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz48IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCI+PHBhdGggc3R5bGU9ImZpbGw6I2ZmZiIgZD0iTTgsNS4xNFYxOS4xNEwxOSwxMi4xNEw4LDUuMTRaIiAvPjwvc3ZnPg==",VideoPause:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz48IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCI+PHBhdGggc3R5bGU9ImZpbGw6I2ZmZiIgZD0iTTE0LDE5LjE0SDE4VjUuMTRIMTRNNiwxOS4xNEgxMFY1LjE0SDZWMTkuMTRaIiAvPjwvc3ZnPg==",WhiteTile:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIABAMAAAAGVsnJAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAB1WlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNS40LjAiPgogICA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPgogICAgICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgICAgICAgICB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyI+CiAgICAgICAgIDx0aWZmOkNvbXByZXNzaW9uPjE8L3RpZmY6Q29tcHJlc3Npb24+CiAgICAgICAgIDx0aWZmOk9yaWVudGF0aW9uPjE8L3RpZmY6T3JpZW50YXRpb24+CiAgICAgICAgIDx0aWZmOlBob3RvbWV0cmljSW50ZXJwcmV0YXRpb24+MjwvdGlmZjpQaG90b21ldHJpY0ludGVycHJldGF0aW9uPgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KAtiABQAAACRQTFRFAAAAAAAABgYGBwcHHh4eKysrx8fHy8vLzMzM7OzsAAAABgYG+q7SZgAAAAp0Uk5TAP7+/v7+/v7+/iJx/a8AAAOwSURBVHja7d0hbsNAEAVQo6SFI6XEcALDcgNLvUBvEBQVhpkWVYWlhSsVFS7t5QIshRt695lEASZP+8c7a1kzDL1fz+/zyuvzp6FbvoddrL6uDd1yGZ5eXldeb18N3fIx7A+58prmhm65DfvDcd0952lu6JabFbD/zVprZj1lzcys+fj9z8xTZtbT8rv8yWlu6BYAIgAAAAAAAAAAAABAM6QXEAEAAAAAAAAAgJ2gnaAIiIA3Q2qAGgAAAAAAAAAAAAAAAAAAAAAAAAAAQJsADkVFAAAAAAA8Bj0GRUAEREAEREAEREAEREAEAAAAAAAAAAB2gnaCIiACPplRA9QANUAERAAAAEVQERQBERCBVlfAcZ3aeZobusUKMGBhV6KUElHGKBERJR6/fxExRkQZl9/lT8S1oVsuhqyYMmPKjCkzvfcCpsxohrwY0Q06EAEAAAAAAAAAAACgGdILiAAAAAAAAAAAwE7QTlAERMCbITVADQAAAAAAAAAAAAAAAAAAAAAAAAAAwKmwQ1ERAAAAAACPQY9BERABERABERABERABERABAAAAAAAAAICdoJ2gCIiAT2bUADVADRABEQAAQBFUBEVABERgEyvAlJm+V4ApM6bMmDJjyowpM6bMdN0LmDKjGfJiRDfoQAQAAAAAAAAAAACAZkgvIAIAAAAAAAAAADtBO0EREAFvhtQANQAAAAAAAAAAAAAAAAAAAAAAAAAAAKfCDkVFAAAAAAA8Bj0GRUAEREAEREAEREAEREAEAAAAAAAAAAB2gnaCIiACPplRA9QANUAERAAAAEVQERQBERCBTawAU2b6XgGmzJgyY8qMKTOmzJgy03UvYMqMZsiLEd2gAxEAAAAAAAAAAAAAmiG9gAgAAAAAAAAAAOwE7QRFQAS8GVID1AAAAAAAAAAAAAAAAAAAAAAAAAAAAJwKOxQVAQAAAADwGPQYFAEREAEREAEREAEREAERAAAAAAAAAADYCdoJioAI+GRGDVAD1AAREAEAABRBRVAEREAENrECTJnpewWYMmPKjCkzpsyYMmPKTNe9gCkzmiEvRnSDDkQAAAAAAAAAAAAAaIb0AiIAAAAAAAAAALATtBMUARHwZkgNUAMAAAAAAAAAAAAAAAAAAAAAAAAAAHAq7FBUBAAAAADAY9BjUAREQAREQAREQAREQAREAAAAAAAAAABgJ2gnKAIi4JMZNUANUANEQAQAAFAEFUEREAER2MQKMGWm7xVgyowpM50PWen9ugNGXz1XaocAFgAAAABJRU5ErkJggg==",Setting:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAABmJLR0QAAAAAAAD5Q7t/AAAACXBIWXMAAABIAAAASABGyWs+AAAACXZwQWcAAABAAAAAQADq8/hgAAADn0lEQVR42u2bzUsVURjGnyO6CPzAMnTjppAo3LTwH1CqTfaxbeOiRS37A0wXtROFVi1aRBs3LWohSIGbQAQXViBGRhG0UIRKUCpK7q/FnOB2uc6cOXNmRnGe3eW+H8/7zLln3vNxpQoVKlQ4wjBFJAFOSRqX1O7osivpvjHmU1nChBZglvSYLYJbS0EanCvIJzWK+gnsyH34/8OuMaYjb265jwCgz6N4SWq3vodbAEmnS/KtBDgoAgyU5BteAOAkMAPcBroc7PskDWfgN+wyDwBdltMMcDI3tYBnde/pHeARMNTErgd4APzweP834oeN1dMkz5DlsFNn/yyv4kdiSK4At4AO4CqwGaDwRmza2B0210qM7YhrXU59ANAq6bWkwQTTn5KO5fIE0uVYlXTeGLOXFMx1DrjlULwKKN41x6DlnIjEEQCckPRe0okCiguJr5LOGGO+xhm5jICJQ1i8LOeJJKPYEQAMKvrtt5ZdjSf2FM0Fq/sZJI2A6UNcvCz36TiDfUcAcE1SPu/U6Mm8k/TFfu6XdFb5iX3dGPM8lQfwNod3+TowBnQ3yddtv1vPIe+b1JIBiwEJ1IAJ208k5W21trWA+V/5CHAcmAtU/A2P/DcCiTAHHE8tgCVhgLvAXgYCk17Jo/yTGfLuWe7Zd72AC8CWB4n3OAz7mLytNkZabAEXMhfeQKYfWEpJZCxA3rGUOZeA/qDF15FpAz47EvlNk9neI2e3jeWCz0BbmvipNkSMMX8kuSZYM8Z8zyqAjbHmaN5mOeYjgIXrU93MWrxHrNQjrqiDkQMLHwG+OdqF3NN3jeXKzU8AoF1SzdH8XKhJUO7HZDXLMbwAwICkJUULFxe0SbqSVQAbw3Xi7Ze0ZLmGAzAKbHs0JGU1QtvAaIjCW4B7ZOvJy2qFa5a730RPtBiaz0CgnkiZi6F5fBZDVMvho7EhcuS3xJJ2hV9IupgTqaLw0hhzab8vq23xOG/r+LDsKjLgYVzxUnU0ltwK2wDezUyJmEwqXgp/PL4rvxthaeCSI+zxuA10J8ZkWdJNSb2SLkvayKHwDRu71+ZajrG941J8agALDQ3GU/a/IvMkYCPzmCbtLNEVmacNtgs5iP9fYVNEV1Q6Hez7yNZSL+J2SarTcpqiyV2iUkG0IvPFvbz5FbEn+KEk3wMjwMeSfCsBXFBdly9CAPk9ydyffpECuB5tZfVJjaKWueOSfinln6YK4lahQoUKRxd/AcRPGTcQCAUQAAAAAElFTkSuQmCC",ChevronRight:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz48IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCI+PHBhdGggZD0iTTguNTksMTYuNThMMTMuMTcsMTJMOC41OSw3LjQxTDEwLDZMMTYsMTJMMTAsMThMOC41OSwxNi41OFoiIC8+PC9zdmc+",Check:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz48IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCI+PHBhdGggZD0iTTIxLDdMOSwxOUwzLjUsMTMuNUw0LjkxLDEyLjA5TDksMTYuMTdMMTkuNTksNS41OUwyMSw3WiIgLz48L3N2Zz4=",ViewIndicator:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPCFET0NUWVBFIHN2ZyBQVUJMSUMgIi0vL1czQy8vRFREIFNWRyAxLjEvL0VOIiAiaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkIj4KPHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBpZD0idmlldy1pbmRpY2F0b3IiIGhlaWdodD0iMzAiIHdpZHRoPSIzMCIgdmlld0JveD0iLTIuNSAtMSAzMCAzMCI+Cgk8c3R5bGUgdHlwZT0idGV4dC9jc3MiPi5zdDB7c3Ryb2tlLXdpZHRoOjI7c3Ryb2tlLW1pdGVybGltaXQ6MTA7ZmlsbDpub25lO30uc3Qxe3N0cm9rZS13aWR0aDo2O3N0cm9rZS1taXRlcmxpbWl0OjEwO30KCTwvc3R5bGU+Cgk8Zz4KCQk8cGF0aCBjbGFzcz0ic3QwIiBkPSJNIDEyLjUgMCBBIDEyLjUgMTIuNSAwIDAgMCAtMTIuNSAwIEEgMTIuNSAxMi41IDAgMCAwIDEyLjUgMCIgdHJhbnNmb3JtPSJtYXRyaXgoMSwwLDAsMSwxMywxNS41KSI+PC9wYXRoPgoJCTxwYXRoIGNsYXNzPSJzdDIiIGQ9Ik0gMTMgMCBMIDEwIDIgTCAxNiAyIFoiPjwvcGF0aD4KCQk8cGF0aCBjbGFzcz0ic3QyIiBkPSJNIDIgMCBBIDIgMiAwIDAgMCAtMiAwIEEgMiAyIDAgMCAwIDIgMCIgdHJhbnNmb3JtPSJtYXRyaXgoMSwwLDAsMSwxMywxNS41KSI+PC9wYXRoPgoJCTxwYXRoIGNsYXNzPSJzdDEiIGlkPSJpbmRpY2F0b3IiIHRyYW5zZm9ybT0ibWF0cml4KDEsMCwwLDEsMTMsMTUuNSkiPjwvcGF0aD4KCTwvZz4KPC9zdmc+"},S={load:function(t,i,n,o){var s,a,r,h;for(h in i=void 0===i?function(){}:i,n=void 0===n?function(){}:n,o=void 0===o?function(){}:o,e.Cache.enabled=!0,R)R.hasOwnProperty(h)&&t===R[h]&&(s=h);var c=e.Cache.get(s||t);if(void 0!==c)return i&&setTimeout(function(){n({loaded:1,total:1}),i(c)},0),c;var l=window.URL||window.webkitURL,d=document.createElementNS("http://www.w3.org/1999/xhtml","img");e.Cache.add(s||t,d);var u=function(){l.revokeObjectURL(d.src),i(d)};if(0===t.indexOf("data:"))return d.addEventListener("load",u,!1),d.src=t,d;d.crossOrigin=void 0!==this.crossOrigin?this.crossOrigin:"",(s=new window.XMLHttpRequest).open("GET",t,!0),s.responseType="arraybuffer",s.addEventListener("error",o),s.addEventListener("progress",function(t){if(t){var e=t.loaded,i=t.total;t.lengthComputable&&n({loaded:e,total:i})}}),s.addEventListener("loadend",function(t){t&&(a=new Uint8Array(t.currentTarget.response),r=new window.Blob([a]),d.addEventListener("load",u,!1),d.src=l.createObjectURL(r))}),s.send(null)}},x={load:function(t,i,n,o){i=void 0===i?function(){}:i;var s=new e.Texture;return S.load(t,function(n){s.image=n,n=0<t.search(/\.(jpg|jpeg)$/)||0===t.search(/^data:image\/jpeg/),s.format=n?e.RGBFormat:e.RGBAFormat,s.needsUpdate=!0,i(s)},n,o),s}},O={load:function(t,i,n,o){var s;i=void 0===i?function(){}:i,n=void 0===n?function(){}:n;var a=new e.CubeTexture([]),r=0,h={},c={};return t.map(function(t,e){S.load(t,function(t){a.images[e]=t,6===++r&&(a.needsUpdate=!0,i(a))},function(t){for(var i in h[e]={loaded:t.loaded,total:t.total},c.loaded=0,s=c.total=0,h)s++,c.loaded+=h[i].loaded,c.total+=h[i].total;6>s&&(c.total=c.total/s*6),n(c)},o)}),a}};i.prototype=Object.assign(Object.create(e.EventDispatcher.prototype),{setContainer:function(t){this.container=t},setScene:function(t){this.scene=t},enumerateDevices:function(){var t=this.devices,e=new Promise(function(e){e(t)});return 0<t.length?e:window.navigator.mediaDevices.enumerateDevices()},switchNextVideoDevice:function(){var t=this.stop.bind(this),e=this.start.bind(this),i=this.setVideDeviceIndex.bind(this),n=this.videoDeviceIndex;this.getDevices("video").then(function(o){t(),++n>=o.length?(i(0),n--):i(n),e(o[n])})},getDevices:function(t){t=void 0===t?"video":t;var e=this.devices;return this.enumerateDevices().then(function(t){return t.map(function(t){return e.includes(t)||e.push(t),t})}).then(function(e){var i=new RegExp(t,"i");return e.filter(function(t){return i.test(t.kind)})})},getUserMedia:function(t){var e=this.setMediaStream.bind(this),i=this.playVideo.bind(this);return window.navigator.mediaDevices.getUserMedia(t).then(e).then(i).catch(function(t){console.warn("PANOLENS.Media: "+t)})},setVideDeviceIndex:function(t){this.videoDeviceIndex=t},start:function(t){var e=this.constraints,i=this.getUserMedia.bind(this);return this.element=this.createVideoElement(),this.getDevices().then(function(n){if(!n||0===n.length)throw Error("no video device found");return e.video.deviceId=(t||n[0]).deviceId,i(e)})},stop:function(){var t=this.stream;t&&t.active&&(t.getTracks()[0].stop(),window.removeEventListener("resize",this.onWindowResize.bind(this)),this.stream=this.element=null)},setMediaStream:function(t){this.stream=t,this.element.srcObject=t,this.scene&&(this.scene.background=this.createVideoTexture()),window.addEventListener("resize",this.onWindowResize.bind(this))},playVideo:function(){var t=this.element;t&&(t.play(),this.dispatchEvent({type:"play"}))},pauseVideo:function(){var t=this.element;t&&(t.pause(),this.dispatchEvent({type:"pause"}))},createVideoTexture:function(){var t=this.element,i=new e.VideoTexture(t);return i.generateMipmaps=!1,i.minFilter=e.LinearFilter,i.magFilter=e.LinearFilter,i.format=e.RGBFormat,i.center.set(.5,.5),t.addEventListener("canplay",this.onWindowResize.bind(this)),i},createVideoElement:function(){var t=this.dispatchEvent.bind(this),e=document.createElement("video");return e.setAttribute("autoplay",""),e.setAttribute("muted",""),e.setAttribute("playsinline",""),e.style.position="absolute",e.style.top="0",e.style.left="0",e.style.width="100%",e.style.height="100%",e.style.objectPosition="center",e.style.objectFit="cover",e.style.display=this.scene?"none":"",e.addEventListener("canplay",function(){return t({type:"canplay"})}),e},onWindowResize:function(){if(this.element&&this.element.videoWidth&&this.element.videoHeight&&this.scene){var t=this.container,e=t.clientWidth;t=t.clientHeight;var i=this.scene.background,n=this.element;n=n.videoHeight/n.videoWidth*(this.container?e/t:1)*this.ratioScalar,e>t?i.repeat.set(n,1):i.repeat.set(1,1/n)}}}),Object.assign(n.prototype,{constructor:n,updateUniformByFormat:function(t,e){this.format=t;var i=e.repeat.value;e=e.offset.value;var n=this.loffset,o=this.roffset;switch(t){case T.TAB:i.set(1,.5),e.set(0,.5),n.set(0,.5),o.set(0,0);break;case T.SBS:i.set(.5,1),e.set(0,0),n.set(0,0),o.set(.5,0)}},updateTextureToLeft:function(t){t.copy(this.loffset)},updateTextureToRight:function(t){t.copy(this.roffset)}}),o.prototype=Object.assign(Object.create(e.Sprite.prototype),{constructor:o,setColor:function(t){this.material.color.copy(t instanceof e.Color?t:new e.Color(t))},createCanvasTexture:function(t){return(t=new e.CanvasTexture(t)).minFilter=e.LinearFilter,t.magFilter=e.LinearFilter,t.generateMipmaps=!1,t},createCanvas:function(){var t=document.createElement("canvas"),e=t.getContext("2d"),i=this.dpr;return t.width=32*i,t.height=32*i,e.scale(i,i),e.shadowBlur=5,e.shadowColor="rgba(200,200,200,0.9)",{canvas:t,context:e}},updateCanvasArcByProgress:function(t){var e=this.context,i=this.canvasWidth,n=this.canvasHeight,o=this.material,s=this.dpr,a=t*Math.PI*2,r=this.color.getStyle(),h=.5*i/s;s=.5*n/s,e.clearRect(0,0,i,n),e.beginPath(),0===t?(e.arc(h,s,i/16,0,2*Math.PI),e.fillStyle=r,e.fill()):(e.arc(h,s,i/4-3,-Math.PI/2,-Math.PI/2+a),e.strokeStyle=r,e.lineWidth=3,e.stroke()),e.closePath(),o.map.needsUpdate=!0},ripple:function(){var t=this,e=this.context,i=this.canvasWidth,n=this.canvasHeight,o=this.material,s=this.rippleDuration,a=performance.now(),r=this.color,h=this.dpr,c=.5*i/h,l=.5*n/h,d=function(){var u=window.requestAnimationFrame(d),p=(performance.now()-a)/s,m=0<1-p?1-p:0,v=p*i*.5/h;e.clearRect(0,0,i,n),e.beginPath(),e.arc(c,l,v,0,2*Math.PI),e.fillStyle="rgba("+255*r.r+", "+255*r.g+", "+255*r.b+", "+m+")",e.fill(),e.closePath(),1<=p&&(window.cancelAnimationFrame(u),t.updateCanvasArcByProgress(0),t.dispatchEvent({type:"reticle-ripple-end"})),o.map.needsUpdate=!0};this.dispatchEvent({type:"reticle-ripple-start"}),d()},show:function(){this.visible=!0},hide:function(){this.visible=!1},start:function(t){this.autoSelect&&(this.dispatchEvent({type:"reticle-start"}),this.startTimestamp=performance.now(),this.callback=t,this.update())},end:function(){this.startTimestamp&&(window.cancelAnimationFrame(this.timerId),this.updateCanvasArcByProgress(0),this.startTimestamp=this.timerId=this.callback=null,this.dispatchEvent({type:"reticle-end"}))},update:function(){this.timerId=window.requestAnimationFrame(this.update.bind(this));var t=(performance.now()-this.startTimestamp)/this.dwellTime;this.updateCanvasArcByProgress(t),this.dispatchEvent({type:"reticle-update",progress:t}),1<=t&&(window.cancelAnimationFrame(this.timerId),this.callback&&this.callback(),this.end(),this.ripple())}});var D,k=(function(t,e){(e=function(){this._tweens={},this._tweensAddedDuringUpdate={}}).prototype={getAll:function(){return Object.keys(this._tweens).map(function(t){return this._tweens[t]}.bind(this))},removeAll:function(){this._tweens={}},add:function(t){this._tweens[t.getId()]=t,this._tweensAddedDuringUpdate[t.getId()]=t},remove:function(t){delete this._tweens[t.getId()],delete this._tweensAddedDuringUpdate[t.getId()]},update:function(t,e){var n=Object.keys(this._tweens);if(0===n.length)return!1;for(t=void 0!==t?t:i.now();0<n.length;){this._tweensAddedDuringUpdate={};for(var o=0;o<n.length;o++){var s=this._tweens[n[o]];s&&!1===s.update(t)&&(s._isPlaying=!1,e||delete this._tweens[n[o]])}n=Object.keys(this._tweensAddedDuringUpdate)}return!0}};var i=new e;i.Group=e,i._nextId=0,i.nextId=function(){return i._nextId++},i.now="undefined"==typeof self&&"undefined"!=typeof process&&process.hrtime?function(){var t=process.hrtime();return 1e3*t[0]+t[1]/1e6}:"undefined"!=typeof self&&void 0!==self.performance&&void 0!==self.performance.now?self.performance.now.bind(self.performance):void 0!==Date.now?Date.now:function(){return(new Date).getTime()},i.Tween=function(t,e){this._object=t,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._repeat=0,this._repeatDelayTime=void 0,this._reversed=this._isPlaying=this._yoyo=!1,this._delayTime=0,this._startTime=null,this._easingFunction=i.Easing.Linear.None,this._interpolationFunction=i.Interpolation.Linear,this._chainedTweens=[],this._onStartCallback=null,this._onStartCallbackFired=!1,this._onStopCallback=this._onCompleteCallback=this._onRepeatCallback=this._onUpdateCallback=null,this._group=e||i,this._id=i.nextId()},i.Tween.prototype={getId:function(){return this._id},isPlaying:function(){return this._isPlaying},to:function(t,e){return this._valuesEnd=Object.create(t),void 0!==e&&(this._duration=e),this},duration:function(t){return this._duration=t,this},start:function(t){for(var e in this._group.add(this),this._isPlaying=!0,this._onStartCallbackFired=!1,this._startTime=void 0!==t?"string"==typeof t?i.now()+parseFloat(t):t:i.now(),this._startTime+=this._delayTime,this._valuesEnd){if(this._valuesEnd[e]instanceof Array){if(0===this._valuesEnd[e].length)continue;this._valuesEnd[e]=[this._object[e]].concat(this._valuesEnd[e])}void 0!==this._object[e]&&(this._valuesStart[e]=this._object[e],0==this._valuesStart[e]instanceof Array&&(this._valuesStart[e]*=1),this._valuesStartRepeat[e]=this._valuesStart[e]||0)}return this},stop:function(){return this._isPlaying?(this._group.remove(this),this._isPlaying=!1,null!==this._onStopCallback&&this._onStopCallback(this._object),this.stopChainedTweens(),this):this},end:function(){return this.update(1/0),this},stopChainedTweens:function(){for(var t=0,e=this._chainedTweens.length;t<e;t++)this._chainedTweens[t].stop()},group:function(t){return this._group=t,this},delay:function(t){return this._delayTime=t,this},repeat:function(t){return this._repeat=t,this},repeatDelay:function(t){return this._repeatDelayTime=t,this},yoyo:function(t){return this._yoyo=t,this},easing:function(t){return this._easingFunction=t,this},interpolation:function(t){return this._interpolationFunction=t,this},chain:function(){return this._chainedTweens=arguments,this},onStart:function(t){return this._onStartCallback=t,this},onUpdate:function(t){return this._onUpdateCallback=t,this},onRepeat:function(t){return this._onRepeatCallback=t,this},onComplete:function(t){return this._onCompleteCallback=t,this},onStop:function(t){return this._onStopCallback=t,this},update:function(t){var e;if(t<this._startTime)return!0;!1===this._onStartCallbackFired&&(null!==this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0);var i=(t-this._startTime)/this._duration;i=0===this._duration||1<i?1:i;var n=this._easingFunction(i);for(e in this._valuesEnd)if(void 0!==this._valuesStart[e]){var o=this._valuesStart[e]||0,s=this._valuesEnd[e];s instanceof Array?this._object[e]=this._interpolationFunction(s,n):("string"==typeof s&&(s="+"===s.charAt(0)||"-"===s.charAt(0)?o+parseFloat(s):parseFloat(s)),"number"==typeof s&&(this._object[e]=o+(s-o)*n))}if(null!==this._onUpdateCallback&&this._onUpdateCallback(this._object,i),1===i){if(!(0<this._repeat)){for(null!==this._onCompleteCallback&&this._onCompleteCallback(this._object),t=0,e=this._chainedTweens.length;t<e;t++)this._chainedTweens[t].start(this._startTime+this._duration);return!1}for(e in isFinite(this._repeat)&&this._repeat--,this._valuesStartRepeat)"string"==typeof this._valuesEnd[e]&&(this._valuesStartRepeat[e]+=parseFloat(this._valuesEnd[e])),this._yoyo&&(i=this._valuesStartRepeat[e],this._valuesStartRepeat[e]=this._valuesEnd[e],this._valuesEnd[e]=i),this._valuesStart[e]=this._valuesStartRepeat[e];this._yoyo&&(this._reversed=!this._reversed),this._startTime=void 0!==this._repeatDelayTime?t+this._repeatDelayTime:t+this._delayTime,null!==this._onRepeatCallback&&this._onRepeatCallback(this._object)}return!0}},i.Easing={Linear:{None:function(t){return t}},Quadratic:{In:function(t){return t*t},Out:function(t){return t*(2-t)},InOut:function(t){return 1>(t*=2)?.5*t*t:-.5*(--t*(t-2)-1)}},Cubic:{In:function(t){return t*t*t},Out:function(t){return--t*t*t+1},InOut:function(t){return 1>(t*=2)?.5*t*t*t:.5*((t-=2)*t*t+2)}},Quartic:{In:function(t){return t*t*t*t},Out:function(t){return 1- --t*t*t*t},InOut:function(t){return 1>(t*=2)?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)}},Quintic:{In:function(t){return t*t*t*t*t},Out:function(t){return--t*t*t*t*t+1},InOut:function(t){return 1>(t*=2)?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)}},Sinusoidal:{In:function(t){return 1-Math.cos(t*Math.PI/2)},Out:function(t){return Math.sin(t*Math.PI/2)},InOut:function(t){return.5*(1-Math.cos(Math.PI*t))}},Exponential:{In:function(t){return 0===t?0:Math.pow(1024,t-1)},Out:function(t){return 1===t?1:1-Math.pow(2,-10*t)},InOut:function(t){return 0===t?0:1===t?1:1>(t*=2)?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))}},Circular:{In:function(t){return 1-Math.sqrt(1-t*t)},Out:function(t){return Math.sqrt(1- --t*t)},InOut:function(t){return 1>(t*=2)?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}},Elastic:{In:function(t){return 0===t?0:1===t?1:-Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)},Out:function(t){return 0===t?0:1===t?1:Math.pow(2,-10*t)*Math.sin(5*(t-.1)*Math.PI)+1},InOut:function(t){return 0===t?0:1===t?1:1>(t*=2)?-.5*Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI):.5*Math.pow(2,-10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)+1}},Back:{In:function(t){return t*t*(2.70158*t-1.70158)},Out:function(t){return--t*t*(2.70158*t+1.70158)+1},InOut:function(t){return 1>(t*=2)?.5*t*t*(3.5949095*t-2.5949095):.5*((t-=2)*t*(3.5949095*t+2.5949095)+2)}},Bounce:{In:function(t){return 1-i.Easing.Bounce.Out(1-t)},Out:function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},InOut:function(t){return.5>t?.5*i.Easing.Bounce.In(2*t):.5*i.Easing.Bounce.Out(2*t-1)+.5}}},i.Interpolation={Linear:function(t,e){var n=t.length-1,o=n*e,s=Math.floor(o),a=i.Interpolation.Utils.Linear;return 0>e?a(t[0],t[1],o):1<e?a(t[n],t[n-1],n-o):a(t[s],t[s+1>n?n:s+1],o-s)},Bezier:function(t,e){for(var n=0,o=t.length-1,s=Math.pow,a=i.Interpolation.Utils.Bernstein,r=0;r<=o;r++)n+=s(1-e,o-r)*s(e,r)*t[r]*a(o,r);return n},CatmullRom:function(t,e){var n=t.length-1,o=n*e,s=Math.floor(o),a=i.Interpolation.Utils.CatmullRom;return t[0]===t[n]?(0>e&&(s=Math.floor(o=n*(1+e))),a(t[(s-1+n)%n],t[s],t[(s+1)%n],t[(s+2)%n],o-s)):0>e?t[0]-(a(t[0],t[0],t[1],t[1],-o)-t[0]):1<e?t[n]-(a(t[n],t[n],t[n-1],t[n-1],o-n)-t[n]):a(t[s?s-1:0],t[s],t[n<s+1?n:s+1],t[n<s+2?n:s+2],o-s)},Utils:{Linear:function(t,e,i){return(e-t)*i+t},Bernstein:function(t,e){var n=i.Interpolation.Utils.Factorial;return n(t)/n(e)/n(t-e)},Factorial:function(){var t=[1];return function(e){var i=1;if(t[e])return t[e];for(var n=e;1<n;n--)i*=n;return t[e]=i}}(),CatmullRom:function(t,e,i,n,o){var s=o*o;return(2*e-2*i+(t=.5*(i-t))+(n=.5*(n-e)))*o*s+(-3*e+3*i-2*t-n)*s+t*o+e}}},t.exports=i}(D={exports:{}},D.exports),D.exports);s.prototype=Object.assign(Object.create(e.Sprite.prototype),{constructor:s,setContainer:function(t){if(t instanceof HTMLElement)var e=t;else t&&t.container&&(e=t.container);e&&this.element&&e.appendChild(this.element),this.container=e},getContainer:function(){return this.container},onClick:function(t){this.element&&this.getContainer()&&(this.onHoverStart(t),this.lockHoverElement())},onDismiss:function(){this.element&&(this.unlockHoverElement(),this.onHoverEnd())},onHover:function(){},onHoverStart:function(t){if(this.getContainer()){var e=this.cursorStyle||(this.mode===L.NORMAL?"pointer":"default"),i=this.scaleDownAnimation,n=this.scaleUpAnimation,o=this.element;this.isHovering=!0,this.container.style.cursor=e,this.animated&&(i.stop(),n.start()),o&&0<=t.mouseEvent.clientX&&0<=t.mouseEvent.clientY&&(t=o.left,e=o.right,i=o.style,this.mode===L.CARDBOARD||this.mode===L.STEREO?(i.display="none",t.style.display="block",e.style.display="block",o._width=t.clientWidth,o._height=t.clientHeight):(i.display="block",t&&(t.style.display="none"),e&&(e.style.display="none"),o._width=o.clientWidth,o._height=o.clientHeight))}},onHoverEnd:function(){if(this.getContainer()){var t=this.scaleDownAnimation,e=this.scaleUpAnimation,i=this.element;this.isHovering=!1,this.container.style.cursor="default",this.animated&&(e.stop(),t.start()),i&&!this.element.locked&&(t=i.left,e=i.right,i.style.display="none",t&&(t.style.display="none"),e&&(e.style.display="none"),this.unlockHoverElement())}},onDualEyeEffect:function(t){if(this.getContainer()){this.mode=t.mode,t=this.element;var e=this.container.clientWidth/2,i=this.container.clientHeight/2;t&&(t.left||t.right||(t.left=t.cloneNode(!0),t.right=t.cloneNode(!0)),this.mode===L.CARDBOARD||this.mode===L.STEREO?(t.left.style.display=t.style.display,t.right.style.display=t.style.display,t.style.display="none"):(t.style.display=t.left.style.display,t.left.style.display="none",t.right.style.display="none"),this.translateElement(e,i),this.container.appendChild(t.left),this.container.appendChild(t.right))}},translateElement:function(t,e){if(this.element._width&&this.element._height&&this.getContainer()){var i=this.container,n=this.element,o=n._width/2,s=n._height/2,a=void 0!==n.verticalDelta?n.verticalDelta:40,r=t-o,h=e-s-a;this.mode!==L.CARDBOARD&&this.mode!==L.STEREO||!n.left||!n.right||t===i.clientWidth/2&&e===i.clientHeight/2?this.setElementStyle("transform",n,"translate("+r+"px, "+h+"px)"):(r=i.clientWidth/4-o+(t-i.clientWidth/2),h=i.clientHeight/2-s-a+(e-i.clientHeight/2),this.setElementStyle("transform",n.left,"translate("+r+"px, "+h+"px)"),r+=i.clientWidth/2,this.setElementStyle("transform",n.right,"translate("+r+"px, "+h+"px)"))}},setElementStyle:function(t,e,i){e=e.style,"transform"===t&&(e.webkitTransform=e.msTransform=e.transform=i)},setText:function(t){this.element&&(this.element.textContent=t)},setCursorHoverStyle:function(t){this.cursorStyle=t},addHoverText:function(t,e){e=void 0===e?40:e,this.element||(this.element=document.createElement("div"),this.element.style.display="none",this.element.style.color="#fff",this.element.style.top=0,this.element.style.maxWidth="50%",this.element.style.maxHeight="50%",this.element.style.textShadow="0 0 3px #000000",this.element.style.fontFamily='"Trebuchet MS", Helvetica, sans-serif',this.element.style.position="absolute",this.element.classList.add("panolens-infospot"),this.element.verticalDelta=e),this.setText(t)},addHoverElement:function(t,e){e=void 0===e?40:e,this.element||(this.element=t.cloneNode(!0),this.element.style.display="none",this.element.style.top=0,this.element.style.position="absolute",this.element.classList.add("panolens-infospot"),this.element.verticalDelta=e)},removeHoverElement:function(){this.element&&(this.element.left&&(this.container.removeChild(this.element.left),this.element.left=null),this.element.right&&(this.container.removeChild(this.element.right),this.element.right=null),this.container.removeChild(this.element),this.element=null)},lockHoverElement:function(){this.element&&(this.element.locked=!0)},unlockHoverElement:function(){this.element&&(this.element.locked=!1)},enableRaycast:function(t){this.raycast=void 0===t||t?this.originalRaycast:function(){}},show:function(t){t=void 0===t?0:t;var e=this.hideAnimation,i=this.showAnimation,n=this.material;this.animated?(e.stop(),i.delay(t).start()):(this.enableRaycast(!0),n.opacity=1)},hide:function(t){t=void 0===t?0:t;var e=this.hideAnimation,i=this.showAnimation,n=this.material;this.animated?(i.stop(),e.delay(t).start()):(this.enableRaycast(!1),n.opacity=0)},setFocusMethod:function(t){t&&(this.HANDLER_FOCUS=t.method)},focus:function(t,e){this.HANDLER_FOCUS&&(this.HANDLER_FOCUS(this.position,t,e),this.onDismiss())},dispose:function(){var t=this.geometry,e=this.material,i=e.map;this.removeHoverElement(),this.parent&&this.parent.remove(this),i&&(i.dispose(),e.map=null),t&&(t.dispose(),this.geometry=null),e&&(e.dispose(),this.material=null)}}),a.prototype=Object.assign(Object.create(e.EventDispatcher.prototype),{constructor:a,addControlBar:function(){if(this.container){var t=this,e=document.createElement("div");e.style.width="100%",e.style.height="44px",e.style.float="left",e.style.transform=e.style.webkitTransform=e.style.msTransform="translateY(-100%)",e.style.background="-webkit-linear-gradient(bottom, rgba(0,0,0,0.2), rgba(0,0,0,0))",e.style.background="-moz-linear-gradient(bottom, rgba(0,0,0,0.2), rgba(0,0,0,0))",e.style.background="-o-linear-gradient(bottom, rgba(0,0,0,0.2), rgba(0,0,0,0))",e.style.background="-ms-linear-gradient(bottom, rgba(0,0,0,0.2), rgba(0,0,0,0))",e.style.background="linear-gradient(bottom, rgba(0,0,0,0.2), rgba(0,0,0,0))",e.style.transition=this.DEFAULT_TRANSITION,e.style.pointerEvents="none",e.isHidden=!1,e.toggle=function(){e.isHidden=!e.isHidden;var t=e.isHidden?0:1;e.style.transform=e.style.webkitTransform=e.style.msTransform=e.isHidden?"translateY(0)":"translateY(-100%)",e.style.opacity=t};var i=this.createDefaultMenu();this.mainMenu=this.createMainMenu(i),e.appendChild(this.mainMenu),this.mask=i=this.createMask(),this.container.appendChild(i),e.dispose=function(){t.fullscreenElement&&(e.removeChild(t.fullscreenElement),t.fullscreenElement.dispose(),t.fullscreenElement=null),t.settingElement&&(e.removeChild(t.settingElement),t.settingElement.dispose(),t.settingElement=null),t.videoElement&&(e.removeChild(t.videoElement),t.videoElement.dispose(),t.videoElement=null)},this.container.appendChild(e),this.mask.addEventListener("mousemove",this.PREVENT_EVENT_HANDLER,!0),this.mask.addEventListener("mouseup",this.PREVENT_EVENT_HANDLER,!0),this.mask.addEventListener("mousedown",this.PREVENT_EVENT_HANDLER,!0),this.mask.addEventListener(t.TOUCH_ENABLED?"touchend":"click",function(e){e.preventDefault(),e.stopPropagation(),t.mask.hide(),t.settingElement.deactivate()},!1),this.addEventListener("control-bar-toggle",e.toggle),this.barElement=e}else console.warn("Widget container not set")},createDefaultMenu:function(){var t=this,e=function(e,i){return function(){t.dispatchEvent({type:"panolens-viewer-handler",method:e,data:i})}};return[{title:"Control",subMenu:[{title:this.TOUCH_ENABLED?"Touch":"Mouse",handler:e("enableControl",I.ORBIT)},{title:"Sensor",handler:e("enableControl",I.DEVICEORIENTATION)}]},{title:"Mode",subMenu:[{title:"Normal",handler:e("disableEffect")},{title:"Cardboard",handler:e("enableEffect",L.CARDBOARD)},{title:"Stereoscopic",handler:e("enableEffect",L.STEREO)}]}]},addControlButton:function(t){switch(t){case"fullscreen":this.fullscreenElement=t=this.createFullscreenButton();break;case"setting":this.settingElement=t=this.createSettingButton();break;case"video":this.videoElement=t=this.createVideoControl();break;default:return}t&&this.barElement.appendChild(t)},createMask:function(){var t=document.createElement("div");return t.style.position="absolute",t.style.top=0,t.style.left=0,t.style.width="100%",t.style.height="100%",t.style.background="transparent",t.style.display="none",t.show=function(){this.style.display="block"},t.hide=function(){this.style.display="none"},t},createSettingButton:function(){var t=this,e=this.createCustomItem({style:{backgroundImage:'url("'+R.Setting+'")',webkitTransition:this.DEFAULT_TRANSITION,transition:this.DEFAULT_TRANSITION},onTap:function(e){e.preventDefault(),e.stopPropagation(),t.mainMenu.toggle(),this.activated?this.deactivate():this.activate()}});return e.activate=function(){this.style.transform="rotate3d(0,0,1,90deg)",this.activated=!0,t.mask.show()},e.deactivate=function(){this.style.transform="rotate3d(0,0,0,0)",this.activated=!1,t.mask.hide(),t.mainMenu&&t.mainMenu.visible&&t.mainMenu.hide(),t.activeSubMenu&&t.activeSubMenu.visible&&t.activeSubMenu.hide(),t.mainMenu&&t.mainMenu._width&&(t.mainMenu.changeSize(t.mainMenu._width),t.mainMenu.unslideAll())},e.activated=!1,e},createFullscreenButton:function(){function t(){n&&(i=!i,s.style.backgroundImage=i?'url("'+R.FullscreenLeave+'")':'url("'+R.FullscreenEnter+'")'),e.dispatchEvent({type:"panolens-viewer-handler",method:"onWindowResize"}),n=!0}var e=this,i=!1,n=!0,o=this.container;if(document.fullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled){document.addEventListener("fullscreenchange",t,!1),document.addEventListener("webkitfullscreenchange",t,!1),document.addEventListener("mozfullscreenchange",t,!1),document.addEventListener("MSFullscreenChange",t,!1);var s=this.createCustomItem({style:{backgroundImage:'url("'+R.FullscreenEnter+'")'},onTap:function(t){t.preventDefault(),t.stopPropagation(),n=!1,i?(document.exitFullscreen&&document.exitFullscreen(),document.msExitFullscreen&&document.msExitFullscreen(),document.mozCancelFullScreen&&document.mozCancelFullScreen(),document.webkitExitFullscreen&&document.webkitExitFullscreen(),i=!1):(o.requestFullscreen&&o.requestFullscreen(),o.msRequestFullscreen&&o.msRequestFullscreen(),o.mozRequestFullScreen&&o.mozRequestFullScreen(),o.webkitRequestFullscreen&&o.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT),i=!0),this.style.backgroundImage=i?'url("'+R.FullscreenLeave+'")':'url("'+R.FullscreenEnter+'")'}});if(!document.querySelector("panolens-style-addon")){var a=document.createElement("style");a.id="panolens-style-addon",a.innerHTML=":-webkit-full-screen { width: 100% !important; height: 100% !important }",document.body.appendChild(a)}return s}},createVideoControl:function(){var t=document.createElement("span");return t.style.display="none",t.show=function(){t.style.display=""},t.hide=function(){t.style.display="none",t.controlButton.paused=!0,t.controlButton.update()},t.controlButton=this.createVideoControlButton(),t.seekBar=this.createVideoControlSeekbar(),t.appendChild(t.controlButton),t.appendChild(t.seekBar),t.dispose=function(){t.removeChild(t.controlButton),t.removeChild(t.seekBar),t.controlButton.dispose(),t.controlButton=null,t.seekBar.dispose(),t.seekBar=null},this.addEventListener("video-control-show",t.show),this.addEventListener("video-control-hide",t.hide),t},createVideoControlButton:function(){var t=this,e=this.createCustomItem({style:{float:"left",backgroundImage:'url("'+R.VideoPlay+'")'},onTap:function(i){i.preventDefault(),i.stopPropagation(),t.dispatchEvent({type:"panolens-viewer-handler",method:"toggleVideoPlay",data:!this.paused}),this.paused=!this.paused,e.update()}});return e.paused=!0,e.update=function(t){this.paused=void 0!==t?t:this.paused,this.style.backgroundImage='url("'+(this.paused?R.VideoPlay:R.VideoPause)+'")'},e},createVideoControlSeekbar:function(){function t(t){t.stopPropagation(),h=!0,o=t.clientX||t.changedTouches&&t.changedTouches[0].clientX,s=parseInt(c.style.width)/100,r.container.addEventListener("mousemove",e,{passive:!0}),r.container.addEventListener("mouseup",i,{passive:!0}),r.container.addEventListener("touchmove",e,{passive:!0}),r.container.addEventListener("touchend",i,{passive:!0})}function e(t){h&&(a=((t.clientX||t.changedTouches&&t.changedTouches[0].clientX)-o)/d.clientWidth,a=1<(a=s+a)?1:0>a?0:a,d.setProgress(a),r.dispatchEvent({type:"panolens-viewer-handler",method:"setVideoCurrentTime",data:a}))}function i(t){t.stopPropagation(),h=!1,n()}function n(){r.container.removeEventListener("mousemove",e,!1),r.container.removeEventListener("mouseup",i,!1),r.container.removeEventListener("touchmove",e,!1),r.container.removeEventListener("touchend",i,!1)}var o,s,a,r=this,h=!1,c=document.createElement("div");c.style.width="0%",c.style.height="100%",c.style.backgroundColor="#fff";var l=document.createElement("div");l.style.float="right",l.style.width="14px",l.style.height="14px",l.style.transform="translate(7px, -5px)",l.style.borderRadius="50%",l.style.backgroundColor="#ddd",l.addEventListener("mousedown",t,{passive:!0}),l.addEventListener("touchstart",t,{passive:!0}),c.appendChild(l);var d=this.createCustomItem({style:{float:"left",width:"30%",height:"4px",marginTop:"20px",backgroundColor:"rgba(188,188,188,0.8)"},onTap:function(t){if(t.preventDefault(),t.stopPropagation(),t.target!==l){var e=t.changedTouches&&0<t.changedTouches.length?(t.changedTouches[0].pageX-t.target.getBoundingClientRect().left)/this.clientWidth:t.offsetX/this.clientWidth;r.dispatchEvent({type:"panolens-viewer-handler",method:"setVideoCurrentTime",data:e}),d.setProgress(t.offsetX/this.clientWidth)}},onDispose:function(){n(),l=c=null}});return d.appendChild(c),d.setProgress=function(t){c.style.width=100*t+"%"},this.addEventListener("video-update",function(t){d.setProgress(t.percentage)}),d.progressElement=c,d.progressElementControl=l,d},createMenuItem:function(t){var e=this,i=document.createElement("a");return i.textContent=t,i.style.display="block",i.style.padding="10px",i.style.textDecoration="none",i.style.cursor="pointer",i.style.pointerEvents="auto",i.style.transition=this.DEFAULT_TRANSITION,i.slide=function(t){this.style.transform="translateX("+(t?"":"-")+"100%)"},i.unslide=function(){this.style.transform="translateX(0)"},i.setIcon=function(t){this.icon&&(this.icon.style.backgroundImage="url("+t+")")},i.setSelectionTitle=function(t){this.selection&&(this.selection.textContent=t)},i.addSelection=function(t){var e=document.createElement("span");return e.style.fontSize="13px",e.style.fontWeight="300",e.style.float="right",this.selection=e,this.setSelectionTitle(t),this.appendChild(e),this},i.addIcon=function(t,e,i){t=void 0===t?R.ChevronRight:t,e=void 0!==e&&e,i=void 0!==i&&i;var n=document.createElement("span");return n.style.float=e?"left":"right",n.style.width="17px",n.style.height="17px",n.style["margin"+(e?"Right":"Left")]="12px",n.style.backgroundSize="cover",i&&(n.style.transform="rotateZ(180deg)"),this.icon=n,this.setIcon(t),this.appendChild(n),this},i.addSubMenu=function(t,i){return this.subMenu=e.createSubMenu(t,i),this},i.addEventListener("mouseenter",function(){this.style.backgroundColor="#e0e0e0"},!1),i.addEventListener("mouseleave",function(){this.style.backgroundColor="#fafafa"},!1),i},createMenuItemHeader:function(t){return(t=this.createMenuItem(t)).style.borderBottom="1px solid #333",t.style.paddingBottom="15px",t},createMainMenu:function(t){function e(t){t.preventDefault(),t.stopPropagation();var e=i.mainMenu,n=this.subMenu;e.hide(),e.slideAll(),e.parentElement.appendChild(n),i.activeMainItem=this,i.activeSubMenu=n,window.requestAnimationFrame(function(){e.changeSize(n.clientWidth),n.show(),n.unslideAll()})}var i=this,n=this.createMenu();n._width=200,n.changeSize(n._width);for(var o=0;o<t.length;o++){var s=n.addItem(t[o].title);s.style.paddingLeft="20px",s.addIcon().addEventListener(i.TOUCH_ENABLED?"touchend":"click",e,!1),t[o].subMenu&&0<t[o].subMenu.length&&s.addSelection(t[o].subMenu[0].title).addSubMenu(t[o].title,t[o].subMenu)}return n},createSubMenu:function(t,e){function i(t){t.preventDefault(),t.stopPropagation(),(n=o.mainMenu).changeSize(n._width),n.unslideAll(),n.show(),s.slideAll(!0),s.hide(),"header"!==this.type&&(s.setActiveItem(this),o.activeMainItem.setSelectionTitle(this.textContent),this.handler&&this.handler())}var n,o=this,s=this.createMenu();for(s.items=e,s.activeItem=null,s.addHeader(t).addIcon(void 0,!0,!0).addEventListener(o.TOUCH_ENABLED?"touchend":"click",i,!1),t=0;t<e.length;t++){var a=s.addItem(e[t].title);a.style.fontWeight=300,a.handler=e[t].handler,a.addIcon(" ",!0),a.addEventListener(o.TOUCH_ENABLED?"touchend":"click",i,!1),s.activeItem||s.setActiveItem(a)}return s.slideAll(!0),s},createMenu:function(){var t=this,e=document.createElement("span"),i=e.style;return i.padding="5px 0",i.position="fixed",i.bottom="100%",i.right="14px",i.backgroundColor="#fafafa",i.fontFamily="Helvetica Neue",i.fontSize="14px",i.visibility="hidden",i.opacity=0,i.boxShadow="0 0 12pt rgba(0,0,0,0.25)",i.borderRadius="2px",i.overflow="hidden",i.willChange="width, height, opacity",i.pointerEvents="auto",i.transition=this.DEFAULT_TRANSITION,e.visible=!1,e.changeSize=function(t,e){t&&(this.style.width=t+"px"),e&&(this.style.height=e+"px")},e.show=function(){this.style.opacity=1,this.style.visibility="visible",this.visible=!0},e.hide=function(){this.style.opacity=0,this.style.visibility="hidden",this.visible=!1},e.toggle=function(){this.visible?this.hide():this.show()},e.slideAll=function(t){for(var i=0;i<e.children.length;i++)e.children[i].slide&&e.children[i].slide(t)},e.unslideAll=function(){for(var t=0;t<e.children.length;t++)e.children[t].unslide&&e.children[t].unslide()},e.addHeader=function(e){return(e=t.createMenuItemHeader(e)).type="header",this.appendChild(e),e},e.addItem=function(e){return(e=t.createMenuItem(e)).type="item",this.appendChild(e),e},e.setActiveItem=function(t){this.activeItem&&this.activeItem.setIcon(" "),t.setIcon(R.Check),this.activeItem=t},e.addEventListener("mousemove",this.PREVENT_EVENT_HANDLER,!0),e.addEventListener("mouseup",this.PREVENT_EVENT_HANDLER,!0),e.addEventListener("mousedown",this.PREVENT_EVENT_HANDLER,!0),e},createCustomItem:function(t){var e=this,i=(t=void 0===t?{}:t).element||document.createElement("span"),n=t.onDispose;return i.style.cursor="pointer",i.style.float="right",i.style.width="44px",i.style.height="100%",i.style.backgroundSize="60%",i.style.backgroundRepeat="no-repeat",i.style.backgroundPosition="center",i.style.webkitUserSelect=i.style.MozUserSelect=i.style.userSelect="none",i.style.position="relative",i.style.pointerEvents="auto",i.addEventListener(e.TOUCH_ENABLED?"touchstart":"mouseenter",function(){i.style.filter=i.style.webkitFilter="drop-shadow(0 0 5px rgba(255,255,255,1))"},{passive:!0}),i.addEventListener(e.TOUCH_ENABLED?"touchend":"mouseleave",function(){i.style.filter=i.style.webkitFilter=""},{passive:!0}),this.mergeStyleOptions(i,t.style),t.onTap&&i.addEventListener(e.TOUCH_ENABLED?"touchend":"click",t.onTap,!1),i.dispose=function(){i.removeEventListener(e.TOUCH_ENABLED?"touchend":"click",t.onTap,!1),n&&t.onDispose()},i},mergeStyleOptions:function(t,e){for(var i in e=void 0===e?{}:e)e.hasOwnProperty(i)&&(t.style[i]=e[i]);return t},dispose:function(){this.barElement&&(this.container.removeChild(this.barElement),this.barElement.dispose(),this.barElement=null)}});var j={tEquirect:{value:new e.Texture},repeat:{value:new e.Vector2(1,1)},offset:{value:new e.Vector2(0,0)},opacity:{value:1}};r.prototype=Object.assign(Object.create(e.Mesh.prototype),{constructor:r,createGeometry:function(t){return new e.BoxBufferGeometry(t,t,t)},createMaterial:function(t,i){t=void 0===t?new e.Vector2(1,1):t,i=void 0===i?new e.Vector2(0,0):i;var n=e.UniformsUtils.clone(j);return n.repeat.value.copy(t),n.offset.value.copy(i),n.opacity.value=0,new e.ShaderMaterial({fragmentShader:"\n        uniform sampler2D tEquirect;\n        uniform vec2 repeat;\n        uniform vec2 offset;\n        uniform float opacity;\n        varying vec3 vWorldDirection;\n        #include <common>\n        void main() {\n            vec3 direction = normalize( vWorldDirection );\n            vec2 sampleUV;\n            sampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n            sampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\n            sampleUV *= repeat;\n            sampleUV += offset;\n            vec4 texColor = texture2D( tEquirect, sampleUV );\n            gl_FragColor = mapTexelToLinear( texColor );\n            gl_FragColor.a *= opacity;\n            #include <tonemapping_fragment>\n            #include <encodings_fragment>\n        }\n    ",vertexShader:"\n        varying vec3 vWorldDirection;\n        #include <common>\n        void main() {\n            vWorldDirection = transformDirection( position, modelMatrix );\n            #include <begin_vertex>\n            #include <project_vertex>\n        }\n    ",uniforms:n,side:e.BackSide,transparent:!0,opacity:0})},add:function(t){if(1<arguments.length){for(var i=0;i<arguments.length;i++)this.add(arguments[i]);return this}t instanceof s&&((i=this.container)&&t.dispatchEvent({type:"panolens-container",container:i}),t.dispatchEvent({type:"panolens-infospot-focus",method:function(t,e,i){this.dispatchEvent({type:"panolens-viewer-handler",method:"tweenControlCenter",data:[t,e,i]})}.bind(this)})),e.Object3D.prototype.add.call(this,t)},getTexture:function(){return this.material.uniforms.tEquirect.value},load:function(){this.onLoad()},onClick:function(t){t.intersects&&0===t.intersects.length&&this.traverse(function(t){t.dispatchEvent({type:"dismiss"})})},setContainer:function(t){if(t instanceof HTMLElement)var e=t;else t&&t.container&&(e=t.container);e&&(this.children.forEach(function(t){t instanceof s&&t.dispatchEvent&&t.dispatchEvent({type:"panolens-container",container:e})}),this.container=e)},onLoad:function(){this.loaded=!0,this.dispatchEvent({type:"load"})},onProgress:function(t){this.dispatchEvent({type:"progress",progress:t})},onError:function(){this.dispatchEvent({type:"error"})},getZoomLevel:function(){return 800>=window.innerWidth?this.ImageQualityFair:800<window.innerWidth&&1280>=window.innerWidth?this.ImageQualityMedium:1280<window.innerWidth&&1920>=window.innerWidth?this.ImageQualityHigh:1920<window.innerWidth?this.ImageQualitySuperHigh:this.ImageQualityLow},updateTexture:function(t){this.material.uniforms.tEquirect.value=t},toggleInfospotVisibility:function(t,e){e=void 0!==e?e:0;var i=void 0!==t?t:!this.isInfospotVisible;this.traverse(function(t){t instanceof s&&(i?t.show(e):t.hide(e))}),this.isInfospotVisible=i,this.infospotAnimation.onComplete(function(){this.dispatchEvent({type:"infospot-animation-complete",visible:i})}.bind(this)).delay(e).start()},setLinkingImage:function(t,e){this.linkingImageURL=t,this.linkingImageScale=e},link:function(t,e,i,n){this.visible=!0,e?((n=new s(i=void 0!==i?i:void 0!==t.linkingImageScale?t.linkingImageScale:300,n=n||(t.linkingImageURL?t.linkingImageURL:R.Arrow))).position.copy(e),n.toPanorama=t,n.addEventListener("click",function(){this.dispatchEvent({type:"panolens-viewer-handler",method:"setPanorama",data:t})}.bind(this)),this.linkedSpots.push(n),this.add(n),this.visible=!1):console.warn("Please specify infospot position for linking")},reset:function(){this.children.length=0},setupTransitions:function(){this.fadeInAnimation=new k.Tween(this.material).easing(k.Easing.Quartic.Out).onStart(function(){this.visible=!0,this.dispatchEvent({type:"enter-fade-start"})}.bind(this)),this.fadeOutAnimation=new k.Tween(this.material).easing(k.Easing.Quartic.Out).onComplete(function(){this.visible=!1,this.dispatchEvent({type:"leave-complete"})}.bind(this)),this.enterTransition=new k.Tween(this).easing(k.Easing.Quartic.Out).onComplete(function(){this.dispatchEvent({type:"enter-complete"})}.bind(this)).start(),this.leaveTransition=new k.Tween(this).easing(k.Easing.Quartic.Out)},onFadeAnimationUpdate:function(){var t=this.material.opacity,e=this.material.uniforms;e&&e.opacity&&(e.opacity.value=t)},fadeIn:function(t){t=0<=t?t:this.animationDuration,this.fadeOutAnimation.stop(),this.fadeInAnimation.to({opacity:1},t).onUpdate(this.onFadeAnimationUpdate.bind(this)).onComplete(function(){this.toggleInfospotVisibility(!0,t/2),this.dispatchEvent({type:"enter-fade-complete"})}.bind(this)).start()},fadeOut:function(t){t=0<=t?t:this.animationDuration,this.fadeInAnimation.stop(),this.fadeOutAnimation.to({opacity:0},t).onUpdate(this.onFadeAnimationUpdate.bind(this)).start()},onEnter:function(){var t=this.animationDuration;this.dispatchEvent({type:"enter"}),this.leaveTransition.stop(),this.enterTransition.to({},t).onStart(function(){this.dispatchEvent({type:"enter-start"}),this.loaded?this.fadeIn(t):this.load()}.bind(this)).start(),this.children.forEach(function(t){t.dispatchEvent({type:"panorama-enter"})}),this.active=!0},onLeave:function(){var t=this.animationDuration;this.enterTransition.stop(),this.leaveTransition.to({},t).onStart(function(){this.dispatchEvent({type:"leave-start"}),this.fadeOut(t),this.toggleInfospotVisibility(!1)}.bind(this)).start(),this.dispatchEvent({type:"leave"}),this.children.forEach(function(t){t.dispatchEvent({type:"panorama-leave"})}),this.active=!1},dispose:function(){var t=this.material;t&&t.uniforms&&t.uniforms.tEquirect&&t.uniforms.tEquirect.value.dispose(),this.infospotAnimation.stop(),this.fadeInAnimation.stop(),this.fadeOutAnimation.stop(),this.enterTransition.stop(),this.leaveTransition.stop(),this.dispatchEvent({type:"panolens-viewer-handler",method:"onPanoramaDispose",data:this}),function t(e){for(var i=e.geometry,n=e.material,o=e.children.length-1;0<=o;o--)t(e.children[o]),e.remove(e.children[o]);e instanceof s&&e.dispose(),i&&(i.dispose(),e.geometry=null),n&&(n.dispose(),e.material=null)}(this),this.parent&&this.parent.remove(this)}}),h.prototype=Object.assign(Object.create(r.prototype),{constructor:h,load:function(t){(t=t||this.src)?"string"==typeof t?x.load(t,this.onLoad.bind(this),this.onProgress.bind(this),this.onError.bind(this)):t instanceof HTMLImageElement&&this.onLoad(new e.Texture(t)):console.warn("Image source undefined")},onLoad:function(t){t.minFilter=t.magFilter=e.LinearFilter,t.needsUpdate=!0,this.updateTexture(t),window.requestAnimationFrame(r.prototype.onLoad.bind(this))},reset:function(){r.prototype.reset.call(this)},dispose:function(){e.Cache.remove(this.src),r.prototype.dispose.call(this)}}),c.prototype=Object.assign(Object.create(r.prototype),{constructor:c,createGeometry:function(){var t=new e.BufferGeometry;return t.addAttribute("position",new e.BufferAttribute(new Float32Array,1)),t},createMaterial:function(){new e.MeshBasicMaterial({color:0,opacity:0,transparent:!0})},getTexture:function(){return null}}),l.prototype=Object.assign(Object.create(r.prototype),{constructor:l,createMaterial:function(){var t=e.ShaderLib.cube,i=t.fragmentShader,n=t.vertexShader;return(t=e.UniformsUtils.clone(t.uniforms)).opacity.value=0,new e.ShaderMaterial({fragmentShader:i,vertexShader:n,uniforms:t,side:e.BackSide,transparent:!0,opacity:0})},load:function(){O.load(this.images,this.onLoad.bind(this),this.onProgress.bind(this),this.onError.bind(this))},onLoad:function(t){this.material.uniforms.tCube.value=t,r.prototype.onLoad.call(this)},getTexture:function(){return this.material.uniforms.tCube.value},dispose:function(){var t=this.material.uniforms.tCube.value;this.images.forEach(function(t){e.Cache.remove(t)}),t instanceof e.CubeTexture&&t.dispose(),r.prototype.dispose.call(this)}}),d.prototype=Object.assign(Object.create(l.prototype),{constructor:d}),u.prototype=Object.assign(Object.create(r.prototype),{constructor:u,isMobile:function(){var t=!1,e=window.navigator.userAgent||window.navigator.vendor||window.opera;return(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(t=!0),t},load:function(){var t=this.options,e=t.muted,i=t.loop,n=t.autoplay,o=t.playsinline;t=t.crossOrigin;var s=this.videoElement,a=this.onProgress.bind(this),r=this.onLoad.bind(this);s.loop=i,s.autoplay=n,s.playsinline=o,s.crossOrigin=t,s.muted=e,o&&(s.setAttribute("playsinline",""),s.setAttribute("webkit-playsinline","")),o=function(){var t=this.setVideoTexture(s);n&&this.dispatchEvent({type:"panolens-viewer-handler",method:"updateVideoPlayButton",data:!1}),this.isMobile()&&(s.pause(),n&&e?this.dispatchEvent({type:"panolens-viewer-handler",method:"updateVideoPlayButton",data:!1}):this.dispatchEvent({type:"panolens-viewer-handler",method:"updateVideoPlayButton",data:!0})),window.requestAnimationFrame(function(){a({loaded:1,total:1}),r(t)})},2<s.readyState?o.call(this):(0===s.querySelectorAll("source").length&&((t=document.createElement("source")).src=this.src,s.appendChild(t)),s.load()),s.addEventListener("loadeddata",o.bind(this)),s.addEventListener("timeupdate",function(){this.videoProgress=0<=s.duration?s.currentTime/s.duration:0,this.dispatchEvent({type:"panolens-viewer-handler",method:"onVideoUpdate",data:this.videoProgress})}.bind(this)),s.addEventListener("ended",function(){i||(this.resetVideo(),this.dispatchEvent({type:"panolens-viewer-handler",method:"updateVideoPlayButton",data:!0}))}.bind(this),!1)},onLoad:function(){r.prototype.onLoad.call(this)},setVideoTexture:function(t){if(t)return(t=new e.VideoTexture(t)).minFilter=e.LinearFilter,t.magFilter=e.LinearFilter,t.format=e.RGBFormat,this.updateTexture(t),t},reset:function(){this.videoElement=void 0,r.prototype.reset.call(this)},isVideoPaused:function(){return this.videoElement.paused},toggleVideo:function(){var t=this.videoElement;t&&t[t.paused?"play":"pause"]()},setVideoCurrentTime:function(t){t=t.percentage;var e=this.videoElement;e&&!Number.isNaN(t)&&1!==t&&(e.currentTime=e.duration*t,this.dispatchEvent({type:"panolens-viewer-handler",method:"onVideoUpdate",data:t}))},playVideo:function(){var t=this.videoElement,e=this.playVideo.bind(this),i=this.dispatchEvent.bind(this);t&&t.paused&&t.play().then(function(){i({type:"play"})}).catch(function(t){window.requestAnimationFrame(e),i({type:"play-error",error:t})})},pauseVideo:function(){var t=this.videoElement;t&&!t.paused&&t.pause(),this.dispatchEvent({type:"pause"})},resumeVideoProgress:function(){var t=this.videoElement;4<=t.readyState&&t.autoplay&&!this.isMobile()?(this.playVideo(),this.dispatchEvent({type:"panolens-viewer-handler",method:"updateVideoPlayButton",data:!1})):(this.pauseVideo(),this.dispatchEvent({type:"panolens-viewer-handler",method:"updateVideoPlayButton",data:!0})),this.setVideoCurrentTime({percentage:this.videoProgress})},resetVideo:function(){this.videoElement&&this.setVideoCurrentTime({percentage:0})},isVideoMuted:function(){return this.videoElement.muted},muteVideo:function(){var t=this.videoElement;t&&!t.muted&&(t.muted=!0),this.dispatchEvent({type:"volumechange"})},unmuteVideo:function(){var t=this.videoElement;t&&this.isVideoMuted()&&(t.muted=!1),this.dispatchEvent({type:"volumechange"})},getVideoElement:function(){return this.videoElement},dispose:function(){this.pauseVideo(),this.removeEventListener("leave",this.pauseVideo.bind(this)),this.removeEventListener("enter-fade-start",this.resumeVideoProgress.bind(this)),this.removeEventListener("video-toggle",this.toggleVideo.bind(this)),this.removeEventListener("video-time",this.setVideoCurrentTime.bind(this)),r.prototype.dispose.call(this)}}),Object.assign(p.prototype,{constructor:p,setProgress:function(t,e){this.onProgress&&this.onProgress({loaded:t,total:e})},adaptTextureToZoom:function(){var t=this.widths[this._zoom],e=this.heights[this._zoom],i=this.maxW,n=this.maxH;this._wc=Math.ceil(t/i),this._hc=Math.ceil(e/n);for(var o=0;o<this._hc;o++)for(var s=0;s<this._wc;s++){var a=document.createElement("canvas");a.width=s<this._wc-1?i:t-i*s,a.height=o<this._hc-1?n:e-n*o,this._canvas.push(a),this._ctx.push(a.getContext("2d"))}},composeFromTile:function(t,e,i){var n=this.maxW,o=this.maxH;t*=512,e*=512;var s=Math.floor(t/n),a=Math.floor(e/o);this._ctx[a*this._wc+s].drawImage(i,0,0,i.width,i.height,t-s*n,e-a*o,512,512),this.progress()},progress:function(){this._count++,this.setProgress(this._count,this._total),this._count===this._total&&(this.canvas=this._canvas,this.panoId=this._panoId,this.zoom=this._zoom,this.onPanoramaLoad)&&this.onPanoramaLoad(this._canvas[0])},composePanorama:function(){this.setProgress(0,1);var t=this.levelsW[this._zoom],e=this.levelsH[this._zoom],i=this;this._count=0,this._total=t*e;for(var n=this._parameters.useWebGL,o=0;o<e;o++)for(var s={},a=0;a<t;s={$jscomp$loop$prop$url$2:s.$jscomp$loop$prop$url$2},a++)s.$jscomp$loop$prop$url$2="https://geo0.ggpht.com/cbk?cb_client=maps_sv.tactile&authuser=0&hl=en&output=tile&zoom="+this._zoom+"&x="+a+"&y="+o+"&panoid="+this._panoId+"&nbt&fover=2",function(t){return function(e,o){if(n)var s=x.load(t.$jscomp$loop$prop$url$2,null,function(){i.composeFromTile(e,o,s)});else{var a=new Image;a.addEventListener("load",function(){i.composeFromTile(e,o,this)}),a.crossOrigin="",a.src=t.$jscomp$loop$prop$url$2}}}(s)(a,o)},load:function(t){this.loadPano(t)},loadPano:function(t){var e=this;this._panoClient.getPanoramaById(t,function(t,i){i===google.maps.StreetViewStatus.OK&&(e.result=t,e.copyright=t.copyright,e._panoId=t.location.pano,e.composePanorama())})},setZoom:function(t){this._zoom=t,this.adaptTextureToZoom()}}),m.prototype=Object.assign(Object.create(h.prototype),{constructor:m,load:function(t){this.loadRequested=!0,t=t||this.panoId||{},this.gsvLoader&&this.loadGSVLoader(t)},setupGoogleMapAPI:function(t){var e=document.createElement("script");e.src="https://maps.googleapis.com/maps/api/js?",e.src+=t?"key="+t:"",e.onreadystatechange=this.setGSVLoader.bind(this),e.onload=this.setGSVLoader.bind(this),document.querySelector("head").appendChild(e)},setGSVLoader:function(){this.gsvLoader=new p,this.loadRequested&&this.load()},getGSVLoader:function(){return this.gsvLoader},loadGSVLoader:function(t){this.loadRequested=!1,this.gsvLoader.onProgress=this.onProgress.bind(this),this.gsvLoader.onPanoramaLoad=this.onLoad.bind(this),this.gsvLoader.setZoom(this.getZoomLevel()),this.gsvLoader.load(t),this.gsvLoader.loaded=!0},onLoad:function(t){h.prototype.onLoad.call(this,new e.Texture(t))},reset:function(){this.gsvLoader=void 0,h.prototype.reset.call(this)}});var P={tDiffuse:{value:new e.Texture},resolution:{value:1},transform:{value:new e.Matrix4},zoom:{value:1},opacity:{value:1}};v.prototype=Object.assign(Object.create(h.prototype),{constructor:v,add:function(t){if(1<arguments.length){for(var e=0;e<arguments.length;e++)this.add(arguments[e]);return this}t instanceof s&&(t.material.depthTest=!1),h.prototype.add.call(this,t)},createGeometry:function(t){return new e.PlaneBufferGeometry(t,.5*t)},createMaterial:function(t){t=void 0===t?this.edgeLength:t;var i=e.UniformsUtils.clone(P);return i.zoom.value=t,i.opacity.value=0,new e.ShaderMaterial({vertexShader:"\n\n        varying vec2 vUv;\n\n        void main() {\n\n            vUv = uv;\n            gl_Position = vec4( position, 1.0 );\n\n        }\n\n    ",fragmentShader:"\n\n        uniform sampler2D tDiffuse;\n        uniform float resolution;\n        uniform mat4 transform;\n        uniform float zoom;\n        uniform float opacity;\n\n        varying vec2 vUv;\n\n        const float PI = 3.141592653589793;\n\n        void main(){\n\n            vec2 position = -1.0 +  2.0 * vUv;\n\n            position *= vec2( zoom * resolution, zoom * 0.5 );\n\n            float x2y2 = position.x * position.x + position.y * position.y;\n            vec3 sphere_pnt = vec3( 2. * position, x2y2 - 1. ) / ( x2y2 + 1. );\n\n            sphere_pnt = vec3( transform * vec4( sphere_pnt, 1.0 ) );\n\n            vec2 sampleUV = vec2(\n                (atan(sphere_pnt.y, sphere_pnt.x) / PI + 1.0) * 0.5,\n                (asin(sphere_pnt.z) / PI + 0.5)\n            );\n\n            gl_FragColor = texture2D( tDiffuse, sampleUV );\n            gl_FragColor.a *= opacity;\n\n        }\n    ",uniforms:i,transparent:!0,opacity:0})},registerMouseEvents:function(){this.container.addEventListener("mousedown",this.onMouseDown.bind(this),{passive:!0}),this.container.addEventListener("mousemove",this.onMouseMove.bind(this),{passive:!0}),this.container.addEventListener("mouseup",this.onMouseUp.bind(this),{passive:!0}),this.container.addEventListener("touchstart",this.onMouseDown.bind(this),{passive:!0}),this.container.addEventListener("touchmove",this.onMouseMove.bind(this),{passive:!0}),this.container.addEventListener("touchend",this.onMouseUp.bind(this),{passive:!0}),this.container.addEventListener("mousewheel",this.onMouseWheel.bind(this),{passive:!1}),this.container.addEventListener("DOMMouseScroll",this.onMouseWheel.bind(this),{passive:!1}),this.container.addEventListener("contextmenu",this.onContextMenu.bind(this),{passive:!0})},unregisterMouseEvents:function(){this.container.removeEventListener("mousedown",this.onMouseDown.bind(this),!1),this.container.removeEventListener("mousemove",this.onMouseMove.bind(this),!1),this.container.removeEventListener("mouseup",this.onMouseUp.bind(this),!1),this.container.removeEventListener("touchstart",this.onMouseDown.bind(this),!1),this.container.removeEventListener("touchmove",this.onMouseMove.bind(this),!1),this.container.removeEventListener("touchend",this.onMouseUp.bind(this),!1),this.container.removeEventListener("mousewheel",this.onMouseWheel.bind(this),!1),this.container.removeEventListener("DOMMouseScroll",this.onMouseWheel.bind(this),!1),this.container.removeEventListener("contextmenu",this.onContextMenu.bind(this),!1)},onMouseDown:function(t){switch(t.touches&&t.touches.length||1){case 1:var e=0<=t.clientX?t.clientX:t.touches[0].clientX;t=0<=t.clientY?t.clientY:t.touches[0].clientY,this.dragging=!0,this.userMouse.set(e,t);break;case 2:e=t.touches[0].pageX-t.touches[1].pageX,t=t.touches[0].pageY-t.touches[1].pageY,this.userMouse.pinchDistance=Math.sqrt(e*e+t*t)}this.onUpdateCallback()},onMouseMove:function(t){switch(t.touches&&t.touches.length||1){case 1:var i=0<=t.clientX?t.clientX:t.touches[0].clientX;t=0<=t.clientY?t.clientY:t.touches[0].clientY;var n=.4*e.Math.degToRad(i-this.userMouse.x),o=.4*e.Math.degToRad(t-this.userMouse.y);this.dragging&&(this.quatA.setFromAxisAngle(this.vectorY,n),this.quatB.setFromAxisAngle(this.vectorX,o),this.quatCur.multiply(this.quatA).multiply(this.quatB),this.userMouse.set(i,t));break;case 2:i=t.touches[0].pageX-t.touches[1].pageX,t=t.touches[0].pageY-t.touches[1].pageY,this.addZoomDelta(this.userMouse.pinchDistance-Math.sqrt(i*i+t*t))}},onMouseUp:function(){this.dragging=!1},onMouseWheel:function(t){t.preventDefault(),t.stopPropagation();var e=0;void 0!==t.wheelDelta?e=t.wheelDelta:void 0!==t.detail&&(e=-t.detail),this.addZoomDelta(e),this.onUpdateCallback()},addZoomDelta:function(t){var e=this.material.uniforms,i=.1*this.size,n=10*this.size;e.zoom.value+=t,e.zoom.value<=i?e.zoom.value=i:e.zoom.value>=n&&(e.zoom.value=n)},onUpdateCallback:function(){this.frameId=window.requestAnimationFrame(this.onUpdateCallback.bind(this)),this.quatSlerp.slerp(this.quatCur,.1),this.material&&this.material.uniforms.transform.value.makeRotationFromQuaternion(this.quatSlerp),!this.dragging&&1-this.quatSlerp.clone().dot(this.quatCur)<this.EPS&&window.cancelAnimationFrame(this.frameId)},reset:function(){this.quatCur.set(0,0,0,1),this.quatSlerp.set(0,0,0,1),this.onUpdateCallback()},updateTexture:function(t){this.material.uniforms.tDiffuse.value=t},getTexture:function(){return this.material.uniforms.tDiffuse.value},onLoad:function(t){this.material.uniforms.resolution.value=this.container.clientWidth/this.container.clientHeight,this.registerMouseEvents(),this.onUpdateCallback(),this.dispatchEvent({type:"panolens-viewer-handler",method:"disableControl"}),h.prototype.onLoad.call(this,t)},onLeave:function(){this.unregisterMouseEvents(),this.dispatchEvent({type:"panolens-viewer-handler",method:"enableControl",data:I.ORBIT}),window.cancelAnimationFrame(this.frameId),h.prototype.onLeave.call(this)},onWindowResize:function(){this.material.uniforms.resolution.value=this.container.clientWidth/this.container.clientHeight},onContextMenu:function(){this.dragging=!1},dispose:function(){this.unregisterMouseEvents(),h.prototype.dispose.call(this)}}),f.prototype=Object.assign(Object.create(v.prototype),{constructor:f,onLoad:function(t){this.updateTexture(t),v.prototype.onLoad.call(this,t)},updateTexture:function(t){t.minFilter=t.magFilter=e.LinearFilter,this.material.uniforms.tDiffuse.value=t},dispose:function(){var t=this.material.uniforms.tDiffuse;t&&t.value&&t.value.dispose(),v.prototype.dispose.call(this)}}),g.prototype=Object.assign(Object.create(r.prototype),{constructor:g,onPanolensContainer:function(t){this.media.setContainer(t.container)},onPanolensScene:function(t){this.media.setScene(t.scene)},start:function(){return this.media.start()},stop:function(){this.media.stop()}}),A.prototype=Object.assign(Object.create(h.prototype),{constructor:A,onLoad:function(t){var e=t.image;this.stereo.updateUniformByFormat(4==e.width/e.height?T.SBS:T.TAB,this.material.uniforms),this.material.uniforms.tEquirect.value=t,h.prototype.onLoad.call(this,t)},updateTextureToLeft:function(){this.stereo.updateTextureToLeft(this.material.uniforms.offset.value)},updateTextureToRight:function(){this.stereo.updateTextureToRight(this.material.uniforms.offset.value)},dispose:function(){var t=this.material.uniforms.tEquirect.value;t instanceof e.Texture&&t.dispose(),h.prototype.dispose.call(this)}}),y.prototype=Object.assign(Object.create(u.prototype),{constructor:y,onLoad:function(t){var e=t.image;this.stereo.updateUniformByFormat(4==e.videoWidth/e.videoHeight?T.SBS:T.TAB,this.material.uniforms),this.material.uniforms.tEquirect.value=t,u.prototype.onLoad.call(this)},updateTextureToLeft:function(){this.stereo.updateTextureToLeft(this.material.uniforms.offset.value)},updateTextureToRight:function(){this.stereo.updateTextureToRight(this.material.uniforms.offset.value)},dispose:function(){var t=this.material.uniforms.tEquirect.value;t instanceof e.Texture&&t.dispose(),u.prototype.dispose.call(this)}}),E.prototype=Object.assign(Object.create(e.EventDispatcher.prototype),{constructor:E}),b.prototype=Object.assign(Object.create(e.EventDispatcher.prototype),{constructor:b});var V=function(t){var i=new e.StereoCamera;i.aspect=.5;var n=new e.Vector2;this.setEyeSeparation=function(t){i.eyeSep=t},this.setSize=function(e,i){t.setSize(e,i)},this.render=function(e,o,s){var a=s instanceof A||s instanceof y;e.updateMatrixWorld(),null===o.parent&&o.updateMatrixWorld(),a&&this.setEyeSeparation(s.stereo.eyeSep),i.update(o),t.getSize(n),t.autoClear&&t.clear(),t.setScissorTest(!0),a&&s.updateTextureToLeft(),t.setScissor(0,0,n.width/2,n.height),t.setViewport(0,0,n.width/2,n.height),t.render(e,i.cameraL),a&&s.updateTextureToRight(),t.setScissor(n.width/2,0,n.width/2,n.height),t.setViewport(n.width/2,0,n.width/2,n.height),t.render(e,i.cameraR),t.setScissorTest(!1),a&&s.updateTextureToLeft()}};M.prototype=Object.assign(Object.create(e.EventDispatcher.prototype),{constructor:M,setupScene:function(t){return void 0===t?new e.Scene:t},setupCamera:function(t,i,n){return void 0===n?new e.PerspectiveCamera(t,i,1,1e4):n},setupRenderer:function(t,i){t=void 0===t?new e.WebGLRenderer({alpha:!0,antialias:!1}):t;var n=i.clientWidth,o=i.clientHeight;return t.setPixelRatio(window.devicePixelRatio),t.setSize(n,o),t.setClearColor(0,0),t.autoClear=!1,t.domElement.classList.add("panolens-canvas"),t.domElement.style.display="block",i.style.backgroundColor="#000",i.appendChild(t.domElement),t},setupControls:function(t,e){var i=this.options,n=i.autoRotate,o=i.autoRotateSpeed,s=i.horizontalView;return(i=new E(t,e)).id="orbit",i.index=I.ORBIT,i.minDistance=1,i.noPan=!0,i.autoRotate=n,i.autoRotateSpeed=o,s&&(i.minPolarAngle=Math.PI/2,i.maxPolarAngle=Math.PI/2),(t=new b(t,e)).id="device-orientation",t.index=I.DEVICEORIENTATION,t.enabled=!1,this.controls=[i,t],this.OrbitControls=i,this.DeviceOrientationControls=t,i},setupEffects:function(t,e){var i=e.clientWidth;e=e.clientHeight;var n=new w(t);return n.setSize(i,e),(t=new V(t)).setSize(i,e),this.CardboardEffect=n,this.StereoEffect=t,n},setupContainer:function(t){return t?(t._width=t.clientWidth,t._height=t.clientHeight,t):((t=document.createElement("div")).classList.add("panolens-container"),t.style.width="100%",t.style.height="100%",document.body.appendChild(t),t)},add:function(t){if(1<arguments.length){for(var e=0;e<arguments.length;e++)this.add(arguments[e]);return this}this.scene.add(t),t.addEventListener&&t.addEventListener("panolens-viewer-handler",this.eventHandler.bind(this)),t instanceof r&&t.dispatchEvent&&t.dispatchEvent({type:"panolens-container",container:this.container}),t instanceof g&&t.dispatchEvent({type:"panolens-scene",scene:this.scene}),t instanceof r&&(this.addPanoramaEventListener(t),this.panorama||(e=this.options.initialLookAt,this.setPanorama(t),this.setControlCenter(e)))},remove:function(t){t.removeEventListener&&t.removeEventListener("panolens-viewer-handler",this.eventHandler.bind(this)),this.scene.remove(t)},addDefaultControlBar:function(t){if(this.widget)console.warn("Default control bar exists");else{var e=new a(this.container);e.addEventListener("panolens-viewer-handler",this.eventHandler.bind(this)),e.addControlBar(),t.forEach(function(t){e.addControlButton(t)}),this.widget=e}},setPanorama:function(t){var e=this.panorama;if(t instanceof r&&e!==t){this.hideInfospot();var i=function(){e&&e.onLeave(),t.removeEventListener("enter-fade-start",i)};t.addEventListener("enter-fade-start",i),(this.panorama=t).onEnter()}},eventHandler:function(t){t.method&&this[t.method]&&this[t.method](t.data)},dispatchEventToChildren:function(t){this.scene.traverse(function(e){e.dispatchEvent&&e.dispatchEvent(t)})},activateWidgetItem:function(t,e){var i=this.widget.mainMenu,n=i.children[0];if(i=i.children[1],void 0!==t){switch(t){case 0:t=n.subMenu.children[1];break;case 1:t=n.subMenu.children[2];break;default:t=n.subMenu.children[1]}n.subMenu.setActiveItem(t),n.setSelectionTitle(t.textContent)}if(void 0!==e){switch(e){case L.CARDBOARD:t=i.subMenu.children[2];break;case L.STEREO:t=i.subMenu.children[3];break;default:t=i.subMenu.children[1]}i.subMenu.setActiveItem(t),i.setSelectionTitle(t.textContent)}},enableEffect:function(t){if(this.mode!==t)if(t===L.NORMAL)this.disableEffect();else{this.mode=t;var e=this.camera.fov;switch(t){case L.CARDBOARD:this.effect=this.CardboardEffect,this.enableReticleControl();break;case L.STEREO:this.effect=this.StereoEffect,this.enableReticleControl();break;default:this.effect=null,this.disableReticleControl()}this.activateWidgetItem(void 0,this.mode),this.dispatchEventToChildren({type:"panolens-dual-eye-effect",mode:this.mode}),this.camera.fov=e+.01,this.effect.setSize(this.container.clientWidth,this.container.clientHeight),this.render(),this.camera.fov=e,this.dispatchEvent({type:"mode-change",mode:this.mode})}},disableEffect:function(){this.mode!==L.NORMAL&&(this.mode=L.NORMAL,this.disableReticleControl(),this.activateWidgetItem(void 0,this.mode),this.dispatchEventToChildren({type:"panolens-dual-eye-effect",mode:this.mode}),this.renderer.setSize(this.container.clientWidth,this.container.clientHeight),this.render(),this.dispatchEvent({type:"mode-change",mode:this.mode}))},enableReticleControl:function(){this.reticle.visible||(this.tempEnableReticle=!0,this.unregisterMouseAndTouchEvents(),this.reticle.show(),this.registerReticleEvent(),this.updateReticleEvent())},disableReticleControl:function(){this.tempEnableReticle=!1,this.options.enableReticle?this.updateReticleEvent():(this.reticle.hide(),this.unregisterReticleEvent(),this.registerMouseAndTouchEvents())},enableAutoRate:function(){this.options.autoRotate=!0,this.OrbitControls.autoRotate=!0},disableAutoRate:function(){clearTimeout(this.autoRotateRequestId),this.options.autoRotate=!1,this.OrbitControls.autoRotate=!1},toggleVideoPlay:function(t){this.panorama instanceof u&&this.panorama.dispatchEvent({type:"video-toggle",pause:t})},setVideoCurrentTime:function(t){this.panorama instanceof u&&this.panorama.dispatchEvent({type:"video-time",percentage:t})},onVideoUpdate:function(t){var e=this.widget;e&&e.dispatchEvent({type:"video-update",percentage:t})},addUpdateCallback:function(t){t&&this.updateCallbacks.push(t)},removeUpdateCallback:function(t){var e=this.updateCallbacks.indexOf(t);t&&0<=e&&this.updateCallbacks.splice(e,1)},showVideoWidget:function(){var t=this.widget;t&&t.dispatchEvent({type:"video-control-show"})},hideVideoWidget:function(){var t=this.widget;t&&t.dispatchEvent({type:"video-control-hide"})},updateVideoPlayButton:function(t){var e=this.widget;e&&e.videoElement&&e.videoElement.controlButton&&e.videoElement.controlButton.update(t)},addPanoramaEventListener:function(t){t.addEventListener("enter",this.setCameraControl.bind(this)),t instanceof u&&(t.addEventListener("enter-fade-start",this.showVideoWidget.bind(this)),t.addEventListener("leave",function(){this.panorama instanceof u||this.hideVideoWidget.call(this)}.bind(this)))},setCameraControl:function(){this.OrbitControls.target.copy(this.panorama.position)},getControl:function(){return this.control},getScene:function(){return this.scene},getCamera:function(){return this.camera},getRenderer:function(){return this.renderer},getContainer:function(){return this.container},getControlId:function(){return this.control.id},getNextControlId:function(){return this.controls[this.getNextControlIndex()].id},getNextControlIndex:function(){var t=this.controls,e=t.indexOf(this.control)+1;return e>=t.length?0:e},setCameraFov:function(t){this.camera.fov=t,this.camera.updateProjectionMatrix()},getRaycastViewCenter:function(){var t=new e.Raycaster;return t.setFromCamera(new e.Vector2(0,0),this.camera),0<(t=t.intersectObject(this.panorama)).length?t[0].point:new e.Vector3(0,0,-1)},enableControl:function(t){t=0<=t&&t<this.controls.length?t:0,this.control.enabled=!1,this.control=this.controls[t],this.control.enabled=!0,this.control.update(),this.setControlCenter(this.getRaycastViewCenter()),this.activateWidgetItem(t,void 0),this.onChange()},disableControl:function(){this.control.enabled=!1},toggleNextControl:function(){this.enableControl(this.getNextControlIndex())},getScreenVector:function(t){t=t.clone();var e=this.container.clientWidth/2,i=this.container.clientHeight/2;return t.project(this.camera),t.x=t.x*e+e,t.y=-t.y*i+i,t.z=0,t},checkSpriteInViewport:function(t){return this.camera.matrixWorldInverse.getInverse(this.camera.matrixWorld),this.cameraViewProjectionMatrix.multiplyMatrices(this.camera.projectionMatrix,this.camera.matrixWorldInverse),this.cameraFrustum.setFromMatrix(this.cameraViewProjectionMatrix),t.visible&&this.cameraFrustum.intersectsSprite(t)},reverseDraggingDirection:function(){this.OrbitControls.rotateSpeed*=-1,this.OrbitControls.momentumScalingFactor*=-1},addReticle:function(t,e){var i=new o(16777215,!0,this.options.dwellTime);return i.hide(),t.add(i),e.add(t),i},rotateControlLeft:function(t){this.control.rotateLeft(t)},rotateControlUp:function(t){this.control.rotateUp(t)},rotateOrbitControl:function(t,e){this.rotateControlLeft(t),this.rotateControlUp(e)},calculateCameraDirectionDelta:function(t){var i=this.camera.getWorldDirection(new e.Vector3),n=i.clone(),o=this.panorama.getWorldPosition(new e.Vector3).sub(this.camera.getWorldPosition(new e.Vector3));(t=t.clone()).add(o).normalize();var s=t.clone();return i.y=0,t.y=0,o=(o=(o=Math.atan2(t.z,t.x)-Math.atan2(i.z,i.x))>Math.PI?o-2*Math.PI:o)<-Math.PI?o+2*Math.PI:o,i=Math.abs(n.angleTo(i)+(0>=n.y*s.y?s.angleTo(t):-s.angleTo(t))),{left:o,up:i*=s.y<n.y?1:-1}},setControlCenter:function(t){t=this.calculateCameraDirectionDelta(t),this.rotateOrbitControl(t.left,t.up)},tweenControlCenter:function(t,e,i){t instanceof Array&&(e=(t=t[0])[1],i=t[2]),e=void 0!==e?e:1e3,i=i||k.Easing.Exponential.Out;var n=this.calculateCameraDirectionDelta(t);t=n.left,n=n.up;var o=this.rotateControlLeft.bind(this),s=this.rotateControlUp.bind(this),a={left:0,up:0},r=0,h=0;this.tweenLeftAnimation.stop(),this.tweenUpAnimation.stop(),this.tweenLeftAnimation=new k.Tween(a).to({left:t},e).easing(i).onUpdate(function(t){o(t.left-r),r=t.left}).start(),this.tweenUpAnimation=new k.Tween(a).to({up:n},e).easing(i).onUpdate(function(t){s(t.up-h),h=t.up}).start()},tweenControlCenterByObject:function(t,i,n){this.tweenControlCenter(t.getWorldPosition(new e.Vector3),i,n)},onWindowResize:function(t,e){var i=this.container.classList.contains("panolens-container")||this.container.isFullscreen;if(void 0!==t&&void 0!==e){var n=t,o=e;this.container._width=t,this.container._height=e}else t=(e=/(android)/i.test(window.navigator.userAgent))?Math.min(document.documentElement.clientWidth,window.innerWidth||0):Math.max(document.documentElement.clientWidth,window.innerWidth||0),e=e?Math.min(document.documentElement.clientHeight,window.innerHeight||0):Math.max(document.documentElement.clientHeight,window.innerHeight||0),n=i?t:this.container.clientWidth,o=i?e:this.container.clientHeight,this.container._width=n,this.container._height=o;this.camera.aspect=n/o,this.camera.updateProjectionMatrix(),this.renderer.setSize(n,o),(this.options.enableReticle||this.tempEnableReticle)&&this.updateReticleEvent(),this.dispatchEvent({type:"window-resize",width:n,height:o}),this.scene.traverse(function(t){t.dispatchEvent&&t.dispatchEvent({type:"window-resize",width:n,height:o})})},addOutputElement:function(){var t=document.createElement("div");t.style.position="absolute",t.style.right="10px",t.style.top="10px",t.style.color="#fff",this.container.appendChild(t),this.outputDivElement=t},outputPosition:function(){var t=this.raycaster.intersectObject(this.panorama,!0);if(0<t.length){t=t[0].point.clone();var i=this.panorama.getWorldPosition(new e.Vector3);if(t.sub(i),i=t.x.toFixed(2)+", "+t.y.toFixed(2)+", "+t.z.toFixed(2),0!==t.length())switch(this.options.output){case"console":console.info(i);break;case"overlay":this.outputDivElement.textContent=i}}},onMouseDown:function(t){t.preventDefault(),this.userMouse.x=0<=t.clientX?t.clientX:t.touches[0].clientX,this.userMouse.y=0<=t.clientY?t.clientY:t.touches[0].clientY,this.userMouse.type="mousedown",this.onTap(t)},onMouseMove:function(t){t.preventDefault(),this.userMouse.type="mousemove",this.onTap(t)},onMouseUp:function(t){this.userMouse.type="mouseup";var e=this.userMouse.x>=t.clientX-this.options.clickTolerance&&this.userMouse.x<=t.clientX+this.options.clickTolerance&&this.userMouse.y>=t.clientY-this.options.clickTolerance&&this.userMouse.y<=t.clientY+this.options.clickTolerance||t.changedTouches&&this.userMouse.x>=t.changedTouches[0].clientX-this.options.clickTolerance&&this.userMouse.x<=t.changedTouches[0].clientX+this.options.clickTolerance&&this.userMouse.y>=t.changedTouches[0].clientY-this.options.clickTolerance&&this.userMouse.y<=t.changedTouches[0].clientY+this.options.clickTolerance?"click":void 0;if((!t||!t.target||t.target.classList.contains("panolens-canvas"))&&(t.preventDefault(),t=t.changedTouches&&1===t.changedTouches.length?this.onTap({clientX:t.changedTouches[0].clientX,clientY:t.changedTouches[0].clientY},e):this.onTap(t,e),this.userMouse.type="none",!t&&"click"===e)){t=(e=this.options).autoHideControlBar;var i=this.panorama,n=this.toggleControlBar;e.autoHideInfospot&&i&&i.toggleInfospotVisibility(),t&&n()}},onTap:function(t,e){var i=this.container.getBoundingClientRect(),n=i.top,o=this.container,a=o.clientHeight;if(this.raycasterPoint.x=(t.clientX-i.left)/o.clientWidth*2-1,this.raycasterPoint.y=-(t.clientY-n)/a*2+1,this.raycaster.setFromCamera(this.raycasterPoint,this.camera),this.panorama){if(("mousedown"!==t.type&&this.touchSupported||this.outputEnabled)&&this.outputPosition(),i=this.raycaster.intersectObjects(this.panorama.children,!0),n=this.getConvertedIntersect(i),o=0<i.length?i[0].object:void 0,"mouseup"===this.userMouse.type&&(n&&this.pressEntityObject===n&&this.pressEntityObject.dispatchEvent&&this.pressEntityObject.dispatchEvent({type:"pressstop-entity",mouseEvent:t}),this.pressEntityObject=void 0),"mouseup"===this.userMouse.type&&(o&&this.pressObject===o&&this.pressObject.dispatchEvent&&this.pressObject.dispatchEvent({type:"pressstop",mouseEvent:t}),this.pressObject=void 0),"click"===e?(this.panorama.dispatchEvent({type:"click",intersects:i,mouseEvent:t}),n&&n.dispatchEvent&&n.dispatchEvent({type:"click-entity",mouseEvent:t}),o&&o.dispatchEvent&&o.dispatchEvent({type:"click",mouseEvent:t})):(this.panorama.dispatchEvent({type:"hover",intersects:i,mouseEvent:t}),(this.hoverObject&&0<i.length&&this.hoverObject!==n||this.hoverObject&&0===i.length)&&(this.hoverObject.dispatchEvent&&(this.hoverObject.dispatchEvent({type:"hoverleave",mouseEvent:t}),this.reticle.end()),this.hoverObject=void 0),n&&0<i.length&&(this.hoverObject!==n&&(this.hoverObject=n,this.hoverObject.dispatchEvent&&(this.hoverObject.dispatchEvent({type:"hoverenter",mouseEvent:t}),(this.options.autoReticleSelect&&this.options.enableReticle||this.tempEnableReticle)&&this.reticle.start(this.onTap.bind(this,t,"click")))),"mousedown"===this.userMouse.type&&this.pressEntityObject!=n&&(this.pressEntityObject=n,this.pressEntityObject.dispatchEvent&&this.pressEntityObject.dispatchEvent({type:"pressstart-entity",mouseEvent:t})),"mousedown"===this.userMouse.type&&this.pressObject!=o&&(this.pressObject=o,this.pressObject.dispatchEvent&&this.pressObject.dispatchEvent({type:"pressstart",mouseEvent:t})),"mousemove"===this.userMouse.type||this.options.enableReticle)&&(o&&o.dispatchEvent&&o.dispatchEvent({type:"hover",mouseEvent:t}),this.pressEntityObject&&this.pressEntityObject.dispatchEvent&&this.pressEntityObject.dispatchEvent({type:"pressmove-entity",mouseEvent:t}),this.pressObject&&this.pressObject.dispatchEvent&&this.pressObject.dispatchEvent({type:"pressmove",mouseEvent:t})),!n&&this.pressEntityObject&&this.pressEntityObject.dispatchEvent&&(this.pressEntityObject.dispatchEvent({type:"pressstop-entity",mouseEvent:t}),this.pressEntityObject=void 0),!o&&this.pressObject&&this.pressObject.dispatchEvent&&(this.pressObject.dispatchEvent({type:"pressstop",mouseEvent:t}),this.pressObject=void 0)),o&&o instanceof s){if(this.infospot=o,"click"===e)return!0}else this.infospot&&this.hideInfospot();this.options.autoRotate&&"mousemove"!==this.userMouse.type&&(clearTimeout(this.autoRotateRequestId),this.control===this.OrbitControls&&(this.OrbitControls.autoRotate=!1,this.autoRotateRequestId=window.setTimeout(this.enableAutoRate.bind(this),this.options.autoRotateActivationDuration)))}},getConvertedIntersect:function(t){for(var e,i=0;i<t.length;i++)if(0<=t[i].distance&&t[i].object&&!t[i].object.passThrough&&(!t[i].object.entity||!t[i].object.entity.passThrough)){e=t[i].object.entity&&!t[i].object.entity.passThrough?t[i].object.entity:t[i].object;break}return e},hideInfospot:function(){this.infospot&&(this.infospot.onHoverEnd(),this.infospot=void 0)},toggleControlBar:function(){var t=this.widget;t&&t.dispatchEvent({type:"control-bar-toggle"})},onKeyDown:function(t){this.options.output&&"none"!==this.options.output&&"Control"===t.key&&(this.outputEnabled=!0)},onKeyUp:function(){this.outputEnabled=!1},update:function(){k.update(),this.updateCallbacks.forEach(function(t){t()}),this.control.update(),this.scene.traverse(function(t){if(t instanceof s&&t.element&&(this.hoverObject===t||"none"!==t.element.style.display||t.element.left&&"none"!==t.element.left.style.display||t.element.right&&"none"!==t.element.right.style.display))if(this.checkSpriteInViewport(t)){var i=this.getScreenVector(t.getWorldPosition(new e.Vector3));t.translateElement(i.x,i.y)}else t.onDismiss()}.bind(this))},render:function(){this.mode===L.CARDBOARD||this.mode===L.STEREO?(this.renderer.clear(),this.effect.render(this.scene,this.camera,this.panorama),this.effect.render(this.sceneReticle,this.camera)):(this.renderer.clear(),this.renderer.render(this.scene,this.camera),this.renderer.clearDepth(),this.renderer.render(this.sceneReticle,this.camera))},animate:function(){this.requestAnimationId=window.requestAnimationFrame(this.animate.bind(this)),this.onChange()},onChange:function(){this.update(),this.render()},registerMouseAndTouchEvents:function(){var t={passive:!1};this.container.addEventListener("mousedown",this.handlerMouseDown,t),this.container.addEventListener("mousemove",this.handlerMouseMove,t),this.container.addEventListener("mouseup",this.handlerMouseUp,t),this.container.addEventListener("touchstart",this.handlerMouseDown,t),this.container.addEventListener("touchend",this.handlerMouseUp,t)},unregisterMouseAndTouchEvents:function(){this.container.removeEventListener("mousedown",this.handlerMouseDown,!1),this.container.removeEventListener("mousemove",this.handlerMouseMove,!1),this.container.removeEventListener("mouseup",this.handlerMouseUp,!1),this.container.removeEventListener("touchstart",this.handlerMouseDown,!1),this.container.removeEventListener("touchend",this.handlerMouseUp,!1)},registerReticleEvent:function(){this.addUpdateCallback(this.handlerTap)},unregisterReticleEvent:function(){this.removeUpdateCallback(this.handlerTap)},updateReticleEvent:function(){var t=this.container.clientWidth/2+this.container.offsetLeft,e=this.container.clientHeight/2;this.removeUpdateCallback(this.handlerTap),this.handlerTap=this.onTap.bind(this,{clientX:t,clientY:e}),this.addUpdateCallback(this.handlerTap)},registerEventListeners:function(){window.addEventListener("resize",this.handlerWindowResize,!0),window.addEventListener("keydown",this.handlerKeyDown,!0),window.addEventListener("keyup",this.handlerKeyUp,!0)},unregisterEventListeners:function(){window.removeEventListener("resize",this.handlerWindowResize,!0),window.removeEventListener("keydown",this.handlerKeyDown,!0),window.removeEventListener("keyup",this.handlerKeyUp,!0)},dispose:function(){this.disableAutoRate(),this.tweenLeftAnimation.stop(),this.tweenUpAnimation.stop(),this.unregisterEventListeners(),function t(e){for(var i=e.children.length-1;0<=i;i--)t(e.children[i]),e.remove(e.children[i]);e instanceof r||e instanceof s?e.dispose():e.dispatchEvent&&e.dispatchEvent("dispose")}(this.scene),this.widget&&(this.widget.dispose(),this.widget=null),e.Cache&&e.Cache.enabled&&e.Cache.clear()},destroy:function(){this.dispose(),this.render(),window.cancelAnimationFrame(this.requestAnimationId)},onPanoramaDispose:function(t){t instanceof u&&this.hideVideoWidget(),t===this.panorama&&(this.panorama=null)},loadAsyncRequest:function(t,e){e=void 0===e?function(){}:e;var i=new window.XMLHttpRequest;i.onloadend=function(t){e(t)},i.open("GET",t,!0),i.send(null)},addViewIndicator:function(){var t=this;this.loadAsyncRequest(R.ViewIndicator,function(i){if(0!==i.loaded){(i=i.target.responseXML.documentElement).style.width=t.viewIndicatorSize+"px",i.style.height=t.viewIndicatorSize+"px",i.style.position="absolute",i.style.top="10px",i.style.left="10px",i.style.opacity="0.5",i.style.cursor="pointer",i.id="panolens-view-indicator-container",t.container.appendChild(i);var n=i.querySelector("#indicator");t.addUpdateCallback(function(){t.radius=.225*t.viewIndicatorSize,t.currentPanoAngle=t.camera.rotation.y-e.Math.degToRad(90),t.fovAngle=e.Math.degToRad(t.camera.fov),t.leftAngle=-t.currentPanoAngle-t.fovAngle/2,t.rightAngle=-t.currentPanoAngle+t.fovAngle/2,t.leftX=t.radius*Math.cos(t.leftAngle),t.leftY=t.radius*Math.sin(t.leftAngle),t.rightX=t.radius*Math.cos(t.rightAngle),t.rightY=t.radius*Math.sin(t.rightAngle),t.indicatorD="M "+t.leftX+" "+t.leftY+" A "+t.radius+" "+t.radius+" 0 0 1 "+t.rightX+" "+t.rightY,t.leftX&&t.leftY&&t.rightX&&t.rightY&&t.radius&&n.setAttribute("d",t.indicatorD)}),i.addEventListener("mouseenter",function(){this.style.opacity="1"}),i.addEventListener("mouseleave",function(){this.style.opacity="0.5"})}})},appendControlItem:function(t){var e=this.widget.createCustomItem(t);return"video"===t.group?this.widget.videoElement.appendChild(e):this.widget.barElement.appendChild(e),e},clearAllCache:function(){e.Cache.clear()}}),"105"!=e.REVISION&&console.warn("three.js version is not matched. Please consider use the target revision 105"),window.TWEEN=k,t.BasicPanorama=d,t.CONTROLS=I,t.CameraPanorama=g,t.CubePanorama=l,t.CubeTextureLoader=O,t.DataImage=R,t.EmptyPanorama=c,t.GoogleStreetviewPanorama=m,t.ImageLittlePlanet=f,t.ImageLoader=S,t.ImagePanorama=h,t.Infospot=s,t.LittlePlanet=v,t.MODES=L,t.Media=i,t.Panorama=r,t.REVISION="11",t.Reticle=o,t.STEREOFORMAT=T,t.Stereo=n,t.StereoImagePanorama=A,t.StereoVideoPanorama=y,t.THREE_REVISION="105",t.THREE_VERSION=C,t.TextureLoader=x,t.VERSION="0.11.0",t.VideoPanorama=u,t.Viewer=M,t.Widget=a,Object.defineProperty(t,"__esModule",{value:!0})});